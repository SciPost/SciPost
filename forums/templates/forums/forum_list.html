{% extends 'forums/base.html' %}

{% load bootstrap %}
{% load restructuredtext %}


{% block breadcrumb_items %}
{{ block.super }}
<span class="breadcrumb-item">Forums</span>
{% endblock %}


{% block pagetitle %}: Forums{% endblock pagetitle %}

{% block content %}

<div class="row">
  <div class="col-12">

    <h3 class="highlight">Forums</h3>
    {% if perms.forums.can_add_forum %}
    <ul>
      <li><a href="{% url 'forums:forum_create' %}">Create a new Forum</a></li>
      <li><a href="{% url 'forums:meeting_create' %}">Create a new Meeting</a></li>
    </ul>
    {% endif %}

    <div class="card-columns">
      {% for forum in object_list %}
      <div class="card">
	<div class="card-header d-flex justify-content-between">
	  {% if forum.meeting %}
	  <span class="badge badge-{{ forum.meeting.context_color }}">Meeting:</span>
	  {% endif %}
	  <a href="{{ forum.get_absolute_url }}">{{ forum }}</a>
	  <span class="badge badge-primary badge-pill">{{ forum.nr_posts }} post{{ forum.nr_posts|pluralize }}</span>
	</div>
	<div class="card-body">
	  {{ forum.description|restructuredtext }}
	  {% if forum.child_forums.all|length > 0 %}
	  <hr/>
	  <p>Descendants:</p>
	  <ul class="list-unstyled forumList">
	    {% for child in forum.child_forums.all %}
	    {% include 'forums/forum_as_li.html' with forum=child %}
	    {% endfor %}
	  </ul>
	  {% endif %}
	</div>
      </div>
      {% empty %}
      <p>No visible Forums found.</p>
      {% endfor %}
    </div>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <h3 class="highlight">Latest postings</h3>
    <table class="table">
      <thead class="thead-default">
	<tr>
	  <th>Forum</th>
	  <th>Latest post</th>
	  <th>Posted on</th>
	  <th>Nr posts</th>
	</tr>
      </thead>
      <tbody>
	{% for forum in object_list %}
	<tr>
	  <td><a href="{{ forum.get_absolute_url }}">{{ forum }}</a></td>
	  <td>{{ forum.latest_post }}</td>
	  <td>{{ forum.latest_post.posted_on|date:"Y-m-d" }}</td>
	  <td>{{ forum.nr_posts }}</td>
	</tr>
	{% empty %}
	<tr>
	  <td>No visible Posts found.</td>
	</tr>
	{% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock content %}
