{% extends 'colleges/base.html' %}

{% load user_groups %}
{% load crispy_forms_tags %}

{% block breadcrumb_items %}
  {{ block.super }}
  <a href="{% url 'colleges:colleges' %}" class="breadcrumb-item">Colleges</a>
  <span class="breadcrumb-item">Nominations</span>
{% endblock %}

{% block meta_description %}{{ block.super }} Nominations{% endblock meta_description %}
{% block pagetitle %}: Nominations{% endblock pagetitle %}

{% block content %}

  {% is_ed_admin request.user as is_ed_admin %}

  <h1 class="highlight">Fellowship Nominations<span class="text-danger ms-4">{% include 'bi/cone-striped.html' %}<em>in construction</em>&nbsp;{% include 'bi/cone-striped.html' %}</span></h1>

  <p>Consult the
    <a href="{% url 'submissions:monitor' %}" target="_blank">Submissions Monitor</a> page.
    Any <span class="text-danger">red-highlighted</span>
    specialty is in need of more Fellows&nbsp;
    {% include 'bi/arrow-right.html' %}
    &nbsp;<strong>Help out by nominating candidates!</strong>
  </p>

  <details class="border border-warning border-2 mt-4">
    <summary class="bg-warning bg-opacity-10 p-2">
      <h2 class="ms-2">Nominate</h2>
    </summary>
    <div class="p-2">
      <div class="row">
	<div class="col-lg-6">
	  <h3>Procedure</h3>
	  <ul>
	    <li>Type your search query in the search form</li>
	    <li>When the name you're looking for appears in the
	      <em>Matching profiles</em> list, double-click on it</li>
	    <li>The nomination form will appear below</li>
	    <li>Non-eligibility flags (if any) will appear</li>
	    <li>If eligible, fill the form in (comments are optional)</li>
	    <li>Submit! (the vote will be arranged by EdAdmin)</li>
	  </ul>
	  <div class="row">
	    <div class="col-8">
	      <form
		  hx-post="{% url 'profiles:_hx_profile_dynsel_list' %}"
		  hx-trigger="keyup delay:200ms, change"
		  hx-target="#profile_dynsel_results"
		  hx-indicator="#profile_dynsel_results-indicator"
	      >
		<div id="profile_dynsel_form">{% crispy profile_dynsel_form %}</div>
	      </form>
	    </div>
	    <div class="col-2">
	      <div id="nomination_form_response-indicator" class="htmx-indicator">
		<button class="btn btn-sm btn-warning" type="button" disabled>
		  <strong>Loading form...</strong>
		  <div class="spinner-grow spinner-grow-sm ms-2" role="status" aria-hidden="true"></div>
		</button>
	      </div>
	    </div>
	    <div class="col-2">
	      <div id="profile_dynsel_results-indicator" class="htmx-indicator">
		<button class="btn btn-sm btn-warning" type="button" disabled>
		  <strong>Loading results...</strong>
		  <div class="spinner-grow spinner-grow-sm ms-2" role="status" aria-hidden="true"></div>
		</button>
	      </div>
	    </div>
	  </div>
	  <h3 class="mb-2">Not found?</h3>
	  <p>Then add to our database by <a href="{% url 'profiles:profile_create' %}" target="_blank">creating a new Profile</a> (opens in new window).</p>
	</div>
	<div class="col-lg-6">
	  <h3>Matching profiles</h3>
	  <div id="profile_dynsel_results" class="border border-light m-2 p-1"></div>
	</div>
      </div>
      <div id="nomination_form_response"></div>
    </div>
  </details>

  {% if "edadmin" in user_roles or "senior_fellow" in user_roles %}
    <details class="border border-danger border-2 mt-4">
      <summary class="bg-danger bg-opacity-10 p-2">
	<h2 class="ms-2">
	  <strong class="text-danger">EdAdmin/Senior Fellows</strong>:
	  ensure specialties in each nominee's profile</h2>
      </summary>
      <div class="p-2 mt-2">
	<div id="nominations_needing_specialties"
	     hx-get="{% url 'colleges:_hx_nominations_needing_specialties' %}"
	     hx-trigger="revealed"
	>
	</div>
      </div>
    </details>
  {% endif %}

  <details class="border border-success border-2 mt-4">
    <summary class="bg-success bg-opacity-10 p-2">
      <h2 class="ms-2">Vote</h2>
    </summary>
    <div class="p-2 mt-2">
      {% if is_ed_admin %}
	<h3 class="highlight mt-4">Ongoing elections</h3>
	<div id="voting_rounds_ongoing"
	     hx-get="{% url 'colleges:_hx_nomination_voting_rounds' %}?filters=ongoing"
	     hx-trigger="revealed"
	>
	</div>
	<h3 class="highlight mt-4">Closed elections</h3>
	<div id="voting_rounds_closed"
	     hx-get="{% url 'colleges:_hx_nomination_voting_rounds' %}?filters=closed"
	     hx-trigger="revealed"
	>
	</div>
      {% else %}
	<h3 class="highlight mt-4">Cast your vote (election ongoing)</h3>
	<div id="voting_rounds_ongoing_vote_required"
	     hx-get="{% url 'colleges:_hx_nomination_voting_rounds' %}?filters=ongoing,vote_required"
	     hx-trigger="revealed"
	>
	</div>
	<h3 class="highlight mt-4">Votes you have cast (election ongoing)</h3>
	<div id="voting_rounds_ongoing_voted"
	     hx-get="{% url 'colleges:_hx_nomination_voting_rounds' %}?filters=ongoing,voted"
	     hx-trigger="revealed"
	>
	</div>
	<h3 class="highlight mt-4">Votes you have cast (election closed)</h3>
	<div id="voting_rounds_closed_voted"
	     hx-get="{% url 'colleges:_hx_nomination_voting_rounds' %}?filters=closed,voted"
	     hx-trigger="revealed"
	>
	</div>
      {% endif %}
    </div>
  </details>

  <details class="border border-2 mt-4" open>
    <summary class="bg-light p-2">
      <h2 class="ms-2">List / filter</h2>
    </summary>
    <div class="p-2 mt-2">
      <form
	  hx-post="{% url 'colleges:_hx_nominations' %}"
	  hx-trigger="load, keyup delay:500ms, change"
	  hx-target="#search-nominations-results"
	  hx-indicator="#indicator-search"
      >
	<div id="search-nominations-form">{% crispy search_nominations_form %}</div>
      </form>

      <div class="row">
	<div class="col">
	  <h3>Nominations list</h3>
	</div>
	<div class="col">
	  <div id="indicator-search-nominations" class="htmx-indicator">
	    <button class="btn btn-sm btn-warning" type="button" disabled>
	      <strong>Loading...</strong>
	      <div class="spinner-grow spinner-grow-sm ms-2" role="status" aria-hidden="true"></div>
	    </button>
	  </div>
	</div>
      </div>
      <ul id="search-nominations-results" class="list-unstyled mt-2"></ul>
    </div>
  </details>

{% endblock content %}
