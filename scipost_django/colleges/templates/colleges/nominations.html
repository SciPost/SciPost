{% extends 'colleges/base.html' %}
{% load user_groups %}
{% load crispy_forms_tags %}

{% block breadcrumb_items %}
  {{ block.super }}
  <a href="{% url 'colleges:colleges' %}" class="breadcrumb-item">Colleges</a>
  <span class="breadcrumb-item">Nominations</span>
{% endblock %}

{% block meta_description %}
  {{ block.super }} Nominations
{% endblock meta_description %}

{% block pagetitle %}
  : Nominations
{% endblock pagetitle %}

{% block content %}
  {% is_ed_admin request.user as is_ed_admin %}
  <h1 class="highlight">Fellowship Nominations</h1>
  <p>
    Consult the
    <a href="{% url 'submissions:monitor' %}" target="_blank">Submissions Monitor</a> page.
    Any <span class="text-danger">red-highlighted</span>
    specialty is in need of more Fellows&nbsp;
    {% include 'bi/arrow-right.html' %}
    &nbsp;<strong>Help out by nominating candidates!</strong>
  </p>

  <div id="new-nomination-container"></div>

  <details id="nominations-filter-details" class="card my-4">
    <summary class="card-header d-flex flex-row align-items-center justify-content-between list-triangle">
      <div class="fs-3">Search / Filter</div>
      <div class="d-none d-md-flex align-items-center">
 
        <div id="indicator-search-nominations" class="htmx-indicator">
          <button class="btn btn-warning text-white d-none d-md-block me-2"
                  type="button"
                  disabled>
            <strong>Loading...</strong>
 
            <div class="spinner-grow spinner-grow-sm ms-2"
                 role="status"
                 aria-hidden="true"></div>
          </button>
        </div>

        <button class="btn btn-outline-secondary me-2"
                type="button"
                hx-get="{% url 'colleges:_hx_nominations_search_form' filter_set="empty" %}"
                hx-target="#nominations-search-form-container">Clear Filters</button>
 
        <button class="btn btn-success me-2 text-white"
                type="button"
                hx-get="{% url 'colleges:_hx_nominations_new' %}"
                hx-trigger="click"
                hx-target="#new-nomination-container">
          {% include "bi/plus-square.html" %}
          &nbsp;Add New
        </button>
 
        <a id="refresh-button" class="me-2 btn btn-primary">
          {% include "bi/arrow-clockwise.html" %}
        &nbsp;Refresh</a>
      </div>

    </summary>
    <div class="card-body">
      <div id="nominations-search-form-container"
           hx-get="{% url 'colleges:_hx_nominations_search_form' filter_set='default' %}"
           hx-trigger="intersect once"></div>
    </div>
  </details>

  <div id="search-nominations-results" class="mt-2"></div>

  {% if "edadmin" in user_roles or "active_senior_fellow" in user_roles %}
    <details id="ensure-specialties-details"
             class="border border-danger border-2 mt-4">
      <summary class="bg-danger bg-opacity-10 p-2 d-block list-triangle">
        <div class="fs-5">Start voting</div>
      </summary>

      <div class="p-2">
        <h3>Add specialties</h3>
        <div id="nominations_needing_specialties"
             hx-get="{% url 'colleges:_hx_nominations_needing_specialties' %}"
             hx-trigger="intersect once"></div>

        <h3 class="mt-4 ">Start round</h3>
        <div id="nominations_no_round_started"
             hx-get="{% url 'colleges:_hx_nominations_no_round_started' %}"
             hx-trigger="intersect once, click from:body target:.nomination-start-round-btn, click from:body target:.nomination-specialties-done-btn">
        </div>
      </div>
    </details>
  {% endif %}

  <details id="voting-details" class="border border-primary border-2 mt-4">
    <summary class="bg-primary bg-opacity-10 p-2 d-block list-triangle">
      <div class="fs-5">

        {% if 'edadmin' not in user_roles %}
          Vote
        {% else %}
          Manage voting
        {% endif %}

      </div>
    </summary>

    <div class="p-2">
      <div id="voting_tablist" hx-trigger="toggle from:#voting-details, click from:body target:.nomination-start-round-btn" hx-get="{% url 'colleges:_hx_nominations' %}?tab= 
        {% if 'edadmin' in user_roles %}ongoing{% else %}ongoing-vote_required{% endif %}
         "></div>
    </div>
  </details>

  {% if "edadmin" in user_roles %}
    <details id="invitations-details" class="border border-success border-2 mt-4">
      <summary class="bg-success bg-opacity-10 p-2 d-block list-triangle">
        <div class="fs-5">Manage invitations</div>
      </summary>

      <div class="p-2 mt-2">
        <div id="invitations_tablist"
             hx-get="{% url 'colleges:_hx_nominations_invitations' %}?response=notyetinvited"
             hx-trigger="toggle from:#invitations-details"
             hx-target="#invitations_tablist"></div>
      </div>
    </details>
  {% endif %}

{% endblock content %}
