{% load scipost_extras %}

{% regroup form.get_timesheets by date as monthly_timesheets %}

{% for date, timesheets_in_month in monthly_timesheets %}
  <h4>{{ date|date:"F Y" }}</h4>
  <table class="table table-hover text-nowrap">
    <thead class="table-light">
      <tr>
        <th>Employee</th>
        <th>Contract hours</th>
        {% if show_time_off_details %}
          <th>Additional hours</th>
          <th>Paid time off</th>
        {% else %}
          <th>Additional hours</th>
        {% endif %}
        <th>Total hours paid</th>
        <th></th>
        <th>Hourly rate</th>
        <th></th>
        <th>Compensation</th>
      </tr>
    </thead>
    <tbody>

      {% for employee_timesheet in timesheets_in_month %}
        <tr>
          <td>{{ employee_timesheet.full_name }}</td>
          <td>{{ employee_timesheet.base_hours|duration }}</td>
          {% if show_time_off_details %}
            <td>{{ employee_timesheet.extra_hours|duration }}</td>
            <td>{{ employee_timesheet.paid_time_off|duration }}</td>
          {% else %}
            <td>{{ employee_timesheet.extra_hours|add:employee_timesheet.paid_time_off|duration }}</td>
          {% endif %}
          <td class="border-start">{{ employee_timesheet.total_hours|duration }}</td>
          <td>&times;</td>
          <td>{{ employee_timesheet.pay_rate|floatformat:2 }} €/h</td>
          <td>=</td>
          <td><span class="fw-bold">{{ employee_timesheet.total_compensation|floatformat:0 }}€</span></td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="7">No logs found.</td>
        </tr>
      {% endfor %}

    </tbody>
  </table>

{% endfor %}
