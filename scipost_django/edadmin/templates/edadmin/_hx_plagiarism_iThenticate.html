{% load bootstrap %}

<div class="row">
  <div class="col">
    <h3>iThenticate report</h3>
    {% if submission.iThenticate_plagiarism_report %}
      <table>
	<tr>
	  <td>Latest update</td>
	  <td>{{ submission.iThenticate_plagiarism_report.latest_activity }}</td>
	</tr>
	<tr>
	  <td style="min-width: 150px;">iThenticate document</td>
	  <td>{{ submission.iThenticate_plagiarism_report.doc_id }}</td>
	</tr>
	<tr>
	  <td>Uploaded</td>
	  <td>{{ submission.iThenticate_plagiarism_report.uploaded_time }}</td>
	</tr>
	{% if submission.iThenticate_plagiarism_report.processed %}
	  <tr>
	    <td>Processed</td>
	    <td>{{ submission.iThenticate_plagiarism_report.processed_time }}</td>
	  </tr>
	  <tr>
	    <td>Percent match</td>
	    <td>{{ submission.iThenticate_plagiarism_report.percent_match }}%</td>
	  </tr>
	  <tr>
	    <td><a href="{% url 'submissions:iThenticate_plagiarism_report' submission.preprint.identifier_w_vn_nr %}" class="btn btn-success text-white" target="_blank">Download report pdf</a></td>
	  </tr>
	{% else %}
	  <tr>
	    <td>Report not yet received</td>
	  </tr>
	{% endif %}
      </table>
    {% else %}
      <p>No report yet</p>
    {% endif %}
    {% if not submission.iThenticate_plagiarism_report.processed %}
      <form
	  class="mt-3" enctype="multipart/form-data"
	  hx-post="{% url 'edadmin:_hx_plagiarism_iThenticate' identifier_w_vn_nr=submission.preprint.identifier_w_vn_nr %}"
	hx-target="#submission-{{ submission.pk }}-iThenticate"
	hx-indicator="#indicator-{{ submission.pk }}-iThenticate"
	>
	{% csrf_token %}
	{{ form|bootstrap }}
	<input type="submit" class="btn btn-primary" value="{% if submission.iThenticate_plagiarism_report %}Update report status{% else %}Submit document for plagiarism check{% endif %}">
      </form>
      <div id="indicator-{{ submission.pk }}-iThenticate" class="htmx-indicator">
	<button class="btn btn-sm btn-warning" type="button" disabled>
	  <strong>Loading...</strong>
	  <div class="spinner-grow spinner-grow-sm ms-2" role="status" aria-hidden="true"></div>
	</button>
      </div>
    {% endif %}
  </div>

  <div class="col">
    <h3>Assessment</h3>
    {% if submission.iThenticate_plagiarism_assessment %}
      {{ submission.iThenticate_plagiarism_assessment }}
    {% else %}
      TODO: assessment form
    {% endif %}
  </div>

</div>
