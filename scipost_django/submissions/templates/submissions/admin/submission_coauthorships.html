{% extends 'submissions/admin/base.html' %}

{% load bootstrap %}
{% load scipost_extras %}

{% block pagetitle %}: Submission Editors{% endblock pagetitle %}

{% block breadcrumb_items %}
  {{block.super}}
  {% if submission.status == 'incoming' %}
    <a href="{% url 'submissions:do_preassignment' submission.preprint.identifier_w_vn_nr %}" class="breadcrumb-item">Preassignment {{ submission.preprint.identifier_w_vn_nr }}</a>
  {% else %}
    <a href="{% url 'submissions:editorial_page' submission.preprint.identifier_w_vn_nr %}" class="breadcrumb-item">Editorial page {{ submission.preprint.identifier_w_vn_nr }}</a>
  {% endif %}
  <span class="breadcrumb-item">Fellow Coauthorships</span>
{% endblock %}

{% block content %}


  <h1 class="highlight">Submission's Fellow Coauthorships</h1>
  <h3><a href="{{ submission.get_absolute_url }}">{{submission.title}}</a></h3>
  <h4>by {{submission.author_list}}</h4>
  <br>

  <h3>Submission summary</h3>
  {% include 'submissions/_submission_summary.html' with submission=submission hide_title=1 show_abstract=0 %}

  <br>
  <a href="{% url 'submissions:editorial_page' submission.preprint.identifier_w_vn_nr %}">Go to editorial page</a>
  <br>
  <br>

  <h3 class="highlight">Fellow Coauthorships</h3>

  <ul class="list-group list-group-flush">
  {% for fellow in submission.fellows_with_coauthorships %}
    <li class="d-flex flex-column p-2 list-group-item">
      <details open>
        <summary class="d-flex list-triangle align-items-center flex-row">
          <span class="fw-bold fs-6">{{ fellow.contributor.profile }}</span>
          <div style="max-width: 600px"
              class="ms-auto coauthorship-fetch-button">
            <span id="coauthorship-{{ fellow.id }}-fetch-indicator"
                  class="htmx-indicator"
                  role="status"
                  aria-hidden="true">
              <span class="spinner-grow spinner-grow-sm"></span></span>
              <button class="btn btn-light btn-sm"
                      hx-indicator="#coauthorship-{{ fellow.id }}-fetch-indicator"
                      hx-post="{% url 'ethics:_hx_fetch_coauthorships_for_submission_authors' submission.preprint.identifier_w_vn_nr fellow.contributor.profile.id %}"
                      hx-target="closest .coauthorship-fetch-button">Update records</button>
          </div>
        </summary>
      <div hx-get="{% url 'ethics:_hx_list_coauthorships_for_submission_authors' submission.preprint.identifier_w_vn_nr fellow.contributor.profile.id %}"
           hx-trigger="task-completed from:closest li"
           hx-swap="innerHTML">
        {% include 'submissions/admin/_coauthorships.html' with coauthorships=fellow.contributor.profile.submission_coauthorships %}
      </div>
      </details>
    </li>
  {% endfor %}
  </ul>

{% endblock %}
