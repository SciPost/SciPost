{% load bootstrap %}
{% load scipost_extras %}
{% load user_groups %}

{% is_edcol_admin request.user as is_edcol_admin %}
{% is_scipost_admin request.user as is_scipost_admin %}


  <div class="card">
    <div class="card-header">
      Details for profile {{ profile.id }}
    </div>
    <div class="card-body">
      <table class="table">
	<tr>
	  <td>Name:</td>
      <td>{{ profile }}</td>
	</tr>
	<tr>
	  <td>Email(s)</td>
	  <td>
	    <table class="table table-sm">
            <thead>
              <tr>
                <th colspan="2">Email</th>
                <th>Still valid</th>
                <th></th>
              </tr>
            </thead>
    	      {% for profile_mail in profile.emails.all %}
        	      <tr>
                      <td>{% if profile_mail.primary %}<strong>{% endif %}{{ profile_mail.email }}{% if profile_mail.primary %}</strong>{% endif %}</td>
                      <td>{{ profile_mail.primary|yesno:'Primary,Alternative' }}</td>
                      <td>
                          <i class="fa {{ profile_mail.still_valid|yesno:'fa-check-circle text-success,fa-times-circle text-danger' }}"></i>

                      </td>
                      <td class="d-flex">
                        <form method="post" action="{% url 'profiles:toggle_email_status' profile_mail.id %}">{% csrf_token %}<button type="submit" class="btn btn-link">{{ profile_mail.still_valid|yesno:'Deprecate,Mark valid' }}</button></form>
			<form method="post" action="{% url 'profiles:email_make_primary' profile_mail.id %}">{% csrf_token %}<button type="submit" class="btn btn-link">Make primary</button></form>
                        <form method="post" action="{% url 'profiles:delete_profile_email' profile_mail.id %}">{% csrf_token %}<button type="submit" class="btn btn-link text-danger ml-2" onclick="return confirm('Sure you want to delete {{ profile_mail.email }}?')"><i class="fa fa-trash"></i></button></form>
                      </td>
                  </tr>
    	      {% endfor %}
          </table>
	  </td>
	</tr>
	<tr>
	  <td>Discipline</td><td>{{ profile.get_discipline_display }}</td>
	</tr>
	<tr>
	  <td>Expertises</td>
	  <td>{% for expertise in profile.expertises %}
    	    <div class="single d-inline" data-specialization="{{expertise|lower}}" data-toggle="tooltip" data-placement="bottom" title="{{expertise|get_specialization_display}}">{{ expertise|get_specialization_code }}</div>
	    {% endfor %}
	  </td>
	</tr>
	<tr><td>ORCID ID</td><td><a href="//orcid.org/{{ profile.orcid_id }}" target="_blank">{{ profile.orcid_id }}</a></td></tr>
	<tr><td>Webpage</td><td><a href="{{ profile.webpage }}" target="_blank">{{ profile.webpage }}</a></td></tr>
	<tr><td>Accepts SciPost emails</td><td>{{ profile.accepts_SciPost_emails }}</td></tr>
	<tr><td>Accepts refereeing requests</td><td>{{ profile.accepts_refereeing_requests }}</td></tr>
	<tr><td>Contributor</td><td>{% if profile.contributor %}Yes, id: {{ profile.contributor.pk }}, status: {{ profile.contributor.get_status_display }}, user active: {{ profile.contributor.user.is_active }} (<a href="{% url 'scipost:contributor_info' contributor_id=profile.contributor.id %}" target="_blank">info link</a>){% else %}No{% endif %}</td></tr>
      </table>
    </div>
  </div>

<div class="card-columns">

  <div class="card">
    <div class="card-header">
      Publications
    </div>
    <div class="card-body">
      <ul>
	{% for pub in profile.publications.all %}
	<li><a href="{{ pub.get_absolute_url }}">{{ pub.citation }}</a></li>
	{% empty %}
	<li>No Publication found</li>
	{% endfor %}
      </ul>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      Comments
    </div>
    <div class="card-body">
      {% for comment in profile.comments.all %}
      <li><a href="{{ comment.get_absolute_url }}">{{ comment }}</a></li>
      {% empty %}
      <li>No Comment found</li>
      {% endfor %}
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      Theses
    </div>
    <div class="card-body">
      {% for thesis in profile.theses.all %}
      <li><a href="{{ thesis.get_absolute_url }}">{{ thesis }}</a></li>
      {% empty %}
      <li>No Thesis found</li>
      {% endfor %}
    </div>
  </div>

</div>

{% if is_scipost_admin or is_edcol_admin %}
<h4 class="highlight p-2 text-danger">Admin-level info</h4>
<div class="card-columns">

  <div class="card">
    <div class="card-header">
      Registration invitations
    </div>
    <div class="card-body">
      <ul>
	{% for reginv in profile.registrationinvitation_set.all %}
	<li>{{ reginv }}<br/>status: {{ reginv.get_status_display }}</li>
	{% empty %}
	<li>No invitation found</li>
	{% endfor %}
      </ul>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      Fellowships and Potential Fellowships
    </div>
    <div class="card-body">
      <h5>Fellowships</h5>
      <ul>
	{% for fellowship in profile.contributor.fellowships.all %}
	<li><a href="{{ fellowship.get_absolute_url }}">{{ fellowship }}</a></li>
	{% empty %}
	<li>No fellowships found</li>
	{% endfor %}
      </ul>
      <h5>Potential Fellowships</h5>
      <ul>
	{% for potfellowship in profile.potentialfellowship_set.all %}
	<li>{{ potfellowship }}</li>
	{% empty %}
	<li>No Potential Fellowships found</li>
	{% endfor %}
      </ul>
    </div>
  </div>



  <div class="card">
    <div class="card-header">
      Refereeing invitations
    </div>
    <div class="card-body">
      <ul>
	{% for inv in profile.refereeinvitation_set.all %}
	<li>{{ inv.submission.title }}<br/>(invited {{ inv.date_invited }}; fulfilled: {% if inv.fulfilled %}<i class="fa fa-check-square text-success"></i>{% else %}<i class="fa fa-times-circle"></i>{% endif %})</li>
	{% empty %}
	<li>No refereeing invitation found</li>
	{% endfor %}
      </ul>
    </div>
  </div>
</div>

<div class="card-columns">
  <div class="card">
    <div class="card-header">
      Actions
    </div>
    <div class="card-body">
      <ul>
    	<li><a href="{% url 'profiles:profile_update' pk=profile.id %}">Update</a> this Profile</li>
    	<li><a href="{% url 'profiles:profile_delete' pk=profile.id %}" class="text-danger">Delete</a> this Profile</li>
        {% if email_form %}
        	<li>
        	  <div>
        	    Add an email to this Profile:
        	    <form class="form-inline" action="{% url 'profiles:add_profile_email' profile_id=profile.id %}" method="post">
        	      {% csrf_token %}
        	      {{ email_form|bootstrap }}
        	      <input class="btn btn-outline-secondary" type="submit" value="Add">
        	    </form>
        	  </div>
        	</li>
        {% endif %}
      </ul>
    </div>
  </div>

</div>
{% endif %}
