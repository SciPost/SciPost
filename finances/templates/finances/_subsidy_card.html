{% load bootstrap %}

{% load user_groups %}

<div class="card-body">
  <div class="row">
    <div class="col-12">

      <h3 class="highlight">Subsidy details</h3>
      {% if perms.scipost.can_manage_subsidies %}
      <ul class="list-inline"><li class="list-inline-item"><strong>Admin actions:</strong></li>
	<li class="list-inline-item"><a href="{% url 'finances:subsidy_update' pk=subsidy.id %}"><span class="text-warning">Update</span></a></li>
	<li class="list-inline-item"><a href="{% url 'finances:subsidy_delete' pk=subsidy.id %}"><span class="text-danger">Delete</span></a></li>
      </ul>
      {% endif %}

      <table class="table">
	<tr>
	  <td>From:</td><td>{% if subsidy.organization.details_publicly_viewable or perms.scipost.can_manage_organizations %}<a href="{{ subsidy.organization.get_absolute_url }}">{{ subsidy.organization }}</a>{% else %}{{ subsidy.organization }}{% endif %}</td>
	</tr>
	<tr>
	  <td>Type:</td><td>{{ subsidy.get_subsidy_type_display }}</td>
	</tr>
	<tr>
	  <td>Description:</td><td>{{ subsidy.description }}</td>
	</tr>
	<tr>
	  <td>Amount:</td><td>{% if subsidy.amount_publicly_shown or perms.scipost.can_manage_subsidies %}&euro;{{ subsidy.amount }}{% else %}-{% endif %}</td>
	</tr>
	<tr>
	  <td>Date:</td><td>{{ subsidy.date }}</td>
	</tr>
	{% if subsidy.date_until %}
	<tr>
	  <td>Date until:</td><td>{{ subsidy.date_until }}</td>
	</tr>
	{% endif %}
      </table>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <h3>Attachments</h3>
      {% if perms.scipost.can_manage_subsidies %}
      <ul>
	<li><a href="{% url 'finances:subsidyattachment_create' subsidy_id=subsidy.id %}">Add a SubsidyAttachment</a> to this Subsidy</li>
      </ul>
      {% endif %}
      <table class="table">
	<tr>
	  <th>File name</th>
	  <th>Publicly visible?</th>
	</tr>
	{% for att in subsidy.attachments.all %}
	<tr>
	  <td><a href="{{ att.get_absolute_url }}" target="_blank">{{ att.name }}</a></td>
	  <td>{{ att.publicly_visible }}</td>
	  {% if perms.scipost.can_manage_subsidies %}
	  <td><a href="{% url 'finances:subsidyattachment_update' pk=att.id %}"><span class="text-warning">Update</span></a></td>
	  <td><a href="{% url 'finances:subsidyattachment_delete' pk=att.id %}"><span class="text-danger">Delete</span></a></td>
	  {% endif %}
	</tr>
	{% empty %}
	<tr>
	  <td>No attachment found</td>
	</tr>
	{% endfor %}
      </table>
    </div>
  </div>

</div>
