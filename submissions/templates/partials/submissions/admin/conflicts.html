{% if conflicts %}
    {{ conflicts|length }} (potential) conflict{{ conflicts|length|pluralize }} found:
    <ul class="fa-ul mt-2">
        {% for conflict in conflicts %}
            <li class="my-1" id="conflict-{{ conflict.id }}">
                <div class="actions status font-weight-bold">
                    {% if conflict.status == 'unverified' %}
                        <i class="fa-li fa fa-question-circle text-warning" aria-hidden="true"></i>
                        Please
                        <a href="javascript:;" onclick="update_conflict({{ conflict.id }}, 'verified')">verify</a>
                        or
                        <a href="javascript:;" class="text-danger" onclick="update_conflict({{ conflict.id }}, 'delete')">delete</a>

                        this conflict.
                    {% elif conflict.status == 'verified' %}
                        <i class="fa-li fa fa-check-circle text-success" aria-hidden="true"></i>
                        <strong>Verified by Admin</strong>
                    {% endif %}
                </div>

                {{ conflict.get_type_display }}:
                {% if conflict.url %}
                    <a href="{{ conflict.url }}" target="_blank">{{ conflict.header }}</a>
                {% else %}
                    {{ conflict.header }}
                {% endif %}
                <br>
                Profiles: {{ conflict.profile }} - {{ conflict.related_profile }}

                {% if conflict.comment %}
                    <br>
                    <em>{{ conflict.comment|linebreaksbr }}</em>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% else %}
    <em><i class="fa fa-check text-success" aria-hidden="true"></i> No conflicts found</em>
{% endif %}


{% block footer_script %}
    <script>
        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        var csrftoken = getCookie('csrftoken');

        function update_conflict(conflict_id, status) {
            $.ajax({
                "method": "POST",
                "url": "{% url 'api:conflictofinterest-verify_conflict' 0 %}".replace("0", conflict_id),
                "data": {
                    'status': status,
                    'csrftoken': getCookie('csrftoken'),
                },
                "beforeSend": function(xhr, settings) {
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                },
            }).done(function( data ) {
                if ( data['status'] == 'verified' ) {
                    $("#conflict-" + data['id'] + " .status").html('<i class="fa-li fa fa-check-circle text-success" aria-hidden="true"></i> Verified by Admin');
                } else if ( data['status'] == 'deprecated' ) {
                    $("#conflict-" + data['id'] ).fadeTo("fast", 0.3).find('.status').html('<i class="fa-li fa fa-times-circle text-danger" aria-hidden="true"></i> <em>Deleted</em>');
                }
            });
        }

    </script>
{% endblock %}
