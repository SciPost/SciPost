{% load submissions_pool %}
{% load user_groups %}

{% is_edcol_admin request.user as is_editorial_admin %}

<div class="icons">
  {% include 'partials/submissions/pool/submission_tooltip.html' with submission=submission %}

  {% if submission.status == 'unassigned' %}
    <i class="fa fa-exclamation mt-1 px-1 text-danger" data-toggle="tooltip" data-html="true" title="You can volunteer to become Editor-in-charge"></i>
  {% endif %}
</div>
<div class="pool-item">
  <div class="row mb-1">
    <div class="col-md-7">
      <a href="{% url 'submissions:submission' submission.preprint.identifier_w_vn_nr %}">{{ submission.title }}</a><br>
      <em>by {{ submission.author_list }}</em>
    </div>
    <div class="col-md-5">
      {% if submission.eicrecommendations.active.first %}
        <small class="text-muted">EIC Recommendation Status</small>
        <br>
        <span class="label label-sm label-secondary">{{ submission.eicrecommendations.active.first.get_full_status_display }}</span>
      {% endif %}
      {% if submission.editorial_decision %}
	<br>
	<small class="text-muted">Editorial Decision Status</small>
	<br>
	<span class="label label-sm label-secondary">{{ submission.editorial_decision.get_status_display }}</span>
      {% endif %}
    </div>
  </div>

  <div class="row mb-0">
    <div class="col-md-2">
      <small class="text-muted">Editor-in-charge</small>
      <br>
      {% if submission.status == 'unassigned' %}
        <span class="card-text text-danger">You can volunteer to become Editor-in-charge by <a href="{% url 'submissions:editorial_assignment' submission.preprint.identifier_w_vn_nr %}">clicking here</a>.</span>
      {% elif submission.editor_in_charge == request.user.contributor %}
        <strong>You are the EIC</strong>
        <a role="button" class="btn btn-info px-1 py-0" href="{% url 'submissions:editorial_page' submission.preprint.identifier_w_vn_nr %}"><small><i class="fa fa-arrow-right"></i> Editorial&nbsp;page</small></a>
      {% else %}
        {{ submission.editor_in_charge }}
      {% endif %}
    </div>
    <div class="col-md-2">
      <small class="text-muted">Actions</small>
      <br>
      <button type="button" class="btn btn-primary px-1 py-0" data-href="{% url 'submissions:pool' submission.preprint.identifier_w_vn_nr %}" data-toggle="modal" data-target="#modal_{{ submission.id }}" data-target-body="#modal_{{ submission.id }}_body"><small>View details</small></button><br>
    </div>
    <div class="col-md-2">
      <small class="text-muted">Original submission date</small>
      <br>
      {{ submission.original_submission_date|date:'Y-m-d' }}
    </div>
    <div class="col-md-2">
      <small class="text-muted">Latest activity</small>
      <br>
      {{ submission.latest_activity }}
    </div>
    <div class="col-md-4">
      <small class="text-muted">Submission Status</small>
      <br>
      <span class="label label-sm label-secondary">{{ submission.get_status_display }}</span>
    </div>
  </div>
  {% if is_editorial_admin and submission.has_inadequate_pool_composition %}
    <div class="border border-danger text-danger mt-1 py-1 px-2">
      <strong>
        <i class="fa fa-exclamation-triangle"></i>
        Notice to admin: The current editor is not assigned to the pool. Therefore, the editor will not be able to reach the editorial page.
      </strong>
    </div>
  {% endif %}
  {% if submission.cycle.has_required_actions %}
    <div class="card-text bg-danger text-white mt-1 py-1 px-2">
      <button type="button" class="btn btn-link p-0" data-href="{% url 'submissions:pool' submission.preprint.identifier_w_vn_nr %}" data-toggle="modal" data-target="#modal_{{ submission.id }}" data-target-body="#modal_{{ submission.id }}_body"><small class="text-white">This Submission contains required actions, click here to see details.</small></button>
      {% if is_editorial_admin %}{% include 'partials/submissions/pool/required_actions_tooltip.html' with submission=submission classes='text-white' %}{% endif %}
    </div>
  {% endif %}

  {% if submission.status == 'unassigned' %}
    {% get_editor_invitations submission request.user as invitations %}
    {% if invitations %}
      <div class="border border-warning mt-1 py-1 px-2">
        <i class="fa fa-exclamation mt-1 px-1 text-danger"></i>
        You are invited to become Editor-in-charge of this Submission. <a href="{% url 'submissions:editorial_assignment' submission.preprint.identifier_w_vn_nr %}">You can reply to this invitation here</a>.
      </div>
    {% endif %}
  {% endif %}

</div>
