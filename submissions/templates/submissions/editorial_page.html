{% extends 'scipost/base.html' %}

{% block pagetitle %}: editorial page for submission{% endblock pagetitle %}

{% block headsup %}

{% load scipost_extras %}

{% endblock headsup %}

{% block bodysup %}


<section>
  <div class="flex-greybox">
    <h1>Editorial Page for Submission</h1>
    {% if not submission.is_current %}
    <h3 style="color: red;">This is not the editorial page for the current version.</h3>
    <p>Please go to the current version's page.</p>
    {% endif %}
    <h3>(go to the <a href="{% url 'submissions:submission' arxiv_identifier_w_vn_nr=submission.arxiv_identifier_w_vn_nr %}">
	Submissions Page</a> to view Reports and Comments)</h3>
  </div>

  {% if other_versions %}
  <h3>Other versions of this Submission exist:</h3>
  <ul>
    {% for vn in other_versions %}
    {{ vn.version_info_as_li }}
    {% endfor %}
  </ul>
  {% endif %}

  <hr class="hr12">
  <div class="row">
    <div class="col-4">
      <h2>Submission:</h2>
    </div>
  </div>
  {{ submission.header_as_table }}

  {% if submission.author_comments %}
  <h3>Author comments upon resubmission</h3>
  <p>{{ submission.author_comments|linebreaks }}</p>
  {% endif %}

  {% if submission.list_of_changes %}
  <h3>List of changes</h3>
  <p>{{ submission.list_of_changes|linebreaks }}</p>
  {% endif %}

  {% if submission.remarks_for_editors %}
  <h3>Comments for the Editor-in-charge</h3>
  <p>{{ submission.remarks_for_editors|linebreaks }}</p>
  {% endif %}

  {% if submission.referees_suggested %}
  <h3>Referees suggested by authors upon submission:</h3>
  <p>{{ submission.referees_suggested }}</p>
  {% endif %}

  {% if submission.referees_flagged %}
  <h3>Referees flagged upon submission (treat reports with caution):</h3>
  <p>{{ submission.referees_flagged }}</p>
  {% endif %}
</section>

{% if recommendation %}
<section>
  <div class="flex-greybox">
    <h1>Editorial Recommendation</h1>
  </div>
  {{ recommendation.print_for_authors }}
</section>
{% endif %}

<section>
  <div class="flex-greybox">
    <h1>Editorial Workflow</h1>
    <a href="{% url 'submissions:editorial_workflow' %}">How-to guide: summary of the editorial workflow</a>
  </div>
  <h3>Status:</h3>
  {{ submission.status_info_as_table }}
  <hr/>
  <h3>Refereeing status summary:</h3>
  {{ submission.refereeing_status_as_p }}
  
  <h4>Detail of refereeing invitations:</h4>
  {% if ref_invitations %}
      <table class="ref_listing">
	{% for invitation in ref_invitations %}
	<tr>
	  {{ invitation.summary_as_tds }}
	  {% if not invitation.accepted == False and not invitation.cancelled %}
	  <td>
	    {% if invitation.referee %}
	    <a href="{% url 'submissions:communication' arxiv_identifier_w_vn_nr=submission.arxiv_identifier_w_vn_nr comtype='EtoR' referee_id=invitation.referee.id %}">Write a communication</a>
	    {% else %}
	    (not yet registered)
	    {% endif %}
	  </td>
	  <td>
	    {% if not invitation.fulfilled %}
	    <a href="{% url 'submissions:ref_invitation_reminder' arxiv_identifier_w_vn_nr=submission.arxiv_identifier_w_vn_nr invitation_id=invitation.id %}">Send reminder email</a>
	    {% else %}
	    <strong style="color: green">Report has been delivered</strong>
	    {% endif %}
	  </td>
	  <td>
	    {% if invitation.nr_reminders > 0 %}
	    (nr reminders sent: {{ invitation.nr_reminders }}, <br/>last on {{ invitation.date_last_reminded }})
	    {% endif %}
	  </td>
	  <td>
	    {% if not invitation.fulfilled %}
	    <a href="{% url 'submissions:cancel_ref_invitation' arxiv_identifier_w_vn_nr=submission.arxiv_identifier_w_vn_nr invitation_id=invitation.id %}">Cancel invitation</a>
	    {% endif %}
	  </td>
	  {% else %}
	  <td></td><td></td><td></td><td></td>
	  {% endif %}
	</tr>
	{% endfor %}
      </table>
  {% else %}
  <p>You have not invited any referees yet.</p>
  {% endif %}

  <hr class="hr6"/>
  <h3>Actions:</h3>
  {% if not submission.is_current %}
  <h3 style="color: red;">BEWARE: This is not the editorial page for the current version.</h3>
  <p>The tools here are thus available only for exceptional circumstances (e.g. vetting a late report on a deprecated version).</p>
  <p>Please go to the current version's page using the link at the top.</p>
  <br/>
  {% endif %}
  <ul>
    <li><a href="{% url 'submissions:select_referee' arxiv_identifier_w_vn_nr=submission.arxiv_identifier_w_vn_nr %}">
	Select an additional referee</a> (bear in mind flagged referees if any)</li>
    <li>Extend the refereeing deadline (currently {{ submission.reporting_deadline|date:'Y-m-d' }}) by 
      <a href="{% url 'submissions:extend_refereeing_deadline' arxiv_identifier_w_vn_nr=submission.arxiv_identifier_w_vn_nr days=2 %}">2 days</a>,
      <a href="{% url 'submissions:extend_refereeing_deadline' arxiv_identifier_w_vn_nr=submission.arxiv_identifier_w_vn_nr days=7 %}">1 week</a> or
      <a href="{% url 'submissions:extend_refereeing_deadline' arxiv_identifier_w_vn_nr=submission.arxiv_identifier_w_vn_nr days=14 %}">2 weeks</a>
      {% if submission.reporting_deadline_has_passed %}
      <b style="color: red">THE REPORTING DEADLINE HAS PASSED</b>
      {% endif %}
      </li>
    <li>
      Set refereeing deadline:
      <form action="{% url 'submissions:set_refereeing_deadline' arxiv_identifier_w_vn_nr=submission.arxiv_identifier_w_vn_nr %}" method="post">
	{% csrf_token %}{{ set_deadline_form }}
	<input type="submit" value="Set deadline"/>
      </form>
    </li>
    <li><a href="{% url 'submissions:vet_submitted_reports' %}">Vet submitted Reports</a> ({{ nr_reports_to_vet }})</li>
    {% if not submission.reporting_deadline_has_passed %}
    <li><a href="{% url 'submissions:close_refereeing_round' arxiv_identifier_w_vn_nr=submission.arxiv_identifier_w_vn_nr %}">Close the refereeing round</a> &nbsp;(deactivates submission of new Reports and Comments)</li>
    {% endif %}
    <li><a href="{% url 'submissions:communication' arxiv_identifier_w_vn_nr=submission.arxiv_identifier_w_vn_nr comtype='EtoA' %}">Draft and send a communication with the submitting Author</a></li>
    <li>Communicate with a Referee: see the table above.
    </li>
    <li><a href="{% url 'submissions:communication' arxiv_identifier_w_vn_nr=submission.arxiv_identifier_w_vn_nr comtype='EtoS' %}">Draft and send a communication with SciPost Editorial Administration</a></li>
    <li><a href="{% url 'submissions:eic_recommendation' arxiv_identifier_w_vn_nr=submission.arxiv_identifier_w_vn_nr %}">Formulate an Editorial Recommendation</a>
    <p>If you recommend revisions, this will be communicated directly to the Authors, who will be asked to resubmit.
      <br/>If you recommend acceptance or rejection, this will be put to the Editorial College for ratification.</p>
    </li>
  </ul>
</section>

<section>
  <div class="flex-greybox">
    <h1>Communications</h1>
  </div>
  {% if communications %}
  <ul>
    {% for comm in communications %}
    {{ comm.print_contents_as_li }}
    {% endfor %}
  </ul>
  {% else %}
  <p>There have been no communications for this Submission.</p>
  {% endif %}
</section>


{% endblock bodysup %}
