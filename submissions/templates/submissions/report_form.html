{% extends 'scipost/_personal_page_base.html' %}

{% block breadcrumb_items %}
    {{block.super}}
    <span class="breadcrumb-item">Submit a report</span>
{% endblock %}

{% load bootstrap %}

{% block pagetitle %}: submit report{% endblock pagetitle %}

{% block content %}
    <script>
        $(function(){
            function set_preview(el) {
                $('#preview-' + $(el).attr('id')).text($(el).val())
            }
            $('#id_weaknesses, #id_strengths, #id_report, #id_requested_changes').on('keyup', function(){
                set_preview(this)
                MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
            })

            $('input[name$="anonymous"]').on('change', function() {
                $('.anonymous-alert').show()
                .children('h3').hide()
                if ($(this).prop('checked')) {
                    $('.anonymous-yes').show();
                } else {
                    $('.anonymous-no').show();
                }
            }).trigger('change');
        });
    </script>


{% if user.is_authenticated %}
    <div class="row">
        <div class="col-12">
            <h1 class="highlight">Submit a Report on a SciPost Submission</h1>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <h2>Submission</h2>
            {% include 'partials/submissions/submission_summary.html' with submission=submission show_abstract=1 %}
        </div>
    </div>

    <hr class="divider">
    <div class="row">
        <div class="col-12">
            <div class="card card-grey">
                <div class="card-body">
                    <h1>Your {% if form.instance.is_followup_report %}followup {% endif %}report:</h1>
                    <p>A preview of text areas will appear below as you type (you can use LaTeX \$...\$ for in-text equations or \ [ ... \ ] for on-line equations).</p>
                    <p class="mb-0">Any fields with an asterisk (*) are required.</p>
                    {% if form.instance.is_followup_report %}
                        <p class="mb-0">
                            Because you have already submitted a Report for this Submission series, not all fields are required.
                        </p>
                    {% endif %}
                </div>
            </div>
            {% if form.report_type == 'report_post_edrec' %}
                <div class="card border-warning my-4">
                    <div class="card-body">The Editorial Recommendation for this Submission has already been formulated. Therefore, your report will be labelled as <label class="label label-warning">Post-Editorial Recommendation Report</label>.
                    </div>
                </div>
            {% endif %}
            <br>
            <form action="{% url 'submissions:submit_report' arxiv_identifier_w_vn_nr=submission.arxiv_identifier_w_vn_nr %}" method="post">
                {% csrf_token %}
                {{ form|bootstrap:'3,9' }}
                <div class="anonymous-alert" style="display: none;">
                    <h3 class="anonymous-yes">Your Report will remain anonymous.</h3>
                    <h3 class="anonymous-no">Your Report will be signed. Thank you very much!</h3>
                </div>
                <p>Any fields with an asterisk (*) are required.</p>
                <input class="btn btn-primary" type="submit" name="save_submit" value="Submit your report"/>
                <input class="btn btn-secondary ml-2" type="submit" name="save_draft" value="Save your report as draft"/>
                {% if form.report_type == 'report_post_edrec' %}
                    <div class="card border-warning mt-4">
                        <div class="card-body">The Editorial Recommendation for this Submission has already been formulated. Therefore, your report will be labelled as <label class="label label-warning">Post-Editorial Recommendation Report</label>.
                        </div>
                    </div>
                {% endif %}
                <div class="my-4">
                    <em>By clicking on Submit, you state that you abide by the <a href="{% url 'journals:journals_terms_and_conditions' %}#referee_code_of_conduct">referee code of conduct</a>.</em>
                </div>
            </form>
        </div>
    </div>

    <hr>
    <div class="row">
        <div class="col-12 report-preview">
            <h3>Preview of your report (text areas only):</h3>

            <h4>Strengths:</h4>
            <p class="latex-preview" id="preview-id_strengths"></p>

            <h4>Weaknesses:</h4>
            <p class="latex-preview" id="preview-id_weaknesses"></p>

            <h4>Report:</h4>
            <p class="latex-preview" id="preview-id_report"></p>

            <h4>Requested changes:</h4>
            <p class="latex-preview" id="preview-id_requested_changes"></p>
        </div>
    </div>

{% endif %}

{% endblock %}
