{% extends 'scipost/base.html' %}

{% block pagetitle %}: submission detail{% endblock pagetitle %}

{% block headsup %}

  <script>
    $(document).ready(function(){
    $("#reportsbutton").click(function(){
    $("#reportslist").toggle();
    });
    $("#commentsbutton").click(function(){
    $("#commentslist").toggle();
    });
    });
  </script>

{% endblock headsup %}

{% block bodysup %}

<!-- Temporary strip -->
{% if user.is_authenticated %}

<section>
  <div class="flex-greybox">
    <h1>SciPost Submission Page &nbsp; (for papers submitted to SciPost)</h1>
  </div>

  <hr class="hr12">
  <div class="row">
    <div class="col-4">
      <h2>Submission:</h2>
    </div>
  </div>
  {{ submission.header_as_table|safe }}
  <h3>Abstract:</h3>
  <p>{{ submission.abstract }}</p>

</section>

{% if reports %}
<section>
  <hr class="hr12">
  <div class="flex-breybox">
    <h2>Reports on this Submission</h2>
    <button id="reportsbutton">Toggle reports view</button>
  </div>

  <div id="reportslist">
    {% for report in reports %}

    <hr class="hr6">
    <div class="row">
      <div class="col-3">
	<div class="reportid">
	  <h3>{{ report.id }}</h3>
	  <h4>Date: {{ report.date_submitted }}</h4>
	</div>
      </div>
    </div>

    <div class="row">
      <div class="col-2">
	<p>Strengths:</p>
      </div>
      <div class="col-10">
	<p>{{ report.strengths }}</p>
      </div>
    </div>
    <div class="row">
      <div class="col-2">
	<p>Weaknesses:</p>
      </div>
      <div class="col-10">
	<p>{{ report.weaknesses }}</p>
      </div>
    </div>
    <div class="row">
      <div class="col-2">
	<p>Report:</p>
      </div>
      <div class="col-10">
	<p>{{ report.report }}</p>
      </div>
    </div>

    {% for reply in author_replies %}
    {% if reply.in_reply_to_report %}
    {% if reply.in_reply_to_report.id = report.id %}
    <div class="row">
      <div class="col-1"></div>
      <hr style="border-style: dotted;" />
      <div class="col-3">
	{{ reply.print_identifier|safe }}
      </div>
    </div>

    <div class="row">
      <div class="col-1"></div>
      <div class="col-10">
	<p>{{ reply.reply_text|linebreaks }}</p>
      </div>
    </div>
    {% endif %}
    {% endif %}
    {% endfor %}

    {% endfor %}
  </div>

</section>
{% endif %}


{% if user.is_authenticated and submission.open_for_reporting and user.contributor.rank > 0 %}
<section>
  <hr class="hr6">
  <div class="row">
    <div class="col-3">
      <h1><a href="{% url 'submissions:submit_report' submission.id %}">Contribute a Report</a></h1>
    </div>
  </div>
</section>
{% endif %}


{% include 'scipost/comments_block.html' %}

{% if user.is_authenticated and submission.open_for_commenting and user.contributor.rank > 0 %}
<section>
  <hr class="hr12">
  <div class="flex-greybox">
    <h1>Contribute a Comment:</h1>
  </div>
  <form action="{% url 'submissions:submission' submission.id %}" method="post">
    {% csrf_token %}
    {% load crispy_forms_tags %}
    {% crispy form %}
  </form>
</section>
{% endif %}

{% endif %} <!-- Temporary strip -->

{% endblock bodysup %}
