{% load scipost_extras %}
{% load comment_extras %}
{% load user_groups %}
{% load submissions_extras %}

{% is_ed_admin request.user as is_ed_admin %}

<div class="commentid" id="comment_id{{ comment.id }}">

  {% if request.user.contributor and request.user.contributor == comment.core_content_object.editor_in_charge or is_ed_admin %}
    {% if request.user|is_possible_author_of_submission:comment.core_content_object %}
      <h3>Anonymous on {{ comment.date_submitted|date:'Y-m-d' }}</h3>
    {% else %}
      <a href="{{ comment.author.get_absolute_url }}">{{ comment.author.user.first_name }} {{ comment.author.user.last_name }}</a>
      on {{ comment.date_submitted|date:'Y-m-d' }}
      {% if comment.anonymous %}
	<small class="text-danger py-2">Chose public anonymity</small>{% endif %}
    {% endif %}
  {% elif comment.anonymous %}
    Anonymous on {{ comment.date_submitted|date:'Y-m-d' }}
  {% else %}
    {% if comment.is_author_reply %}Author {% endif %}
    <a href="{{ comment.author.get_absolute_url }}">{{ comment.author.user.first_name }} {{ comment.author.user.last_name }}</a>
    on {{ comment.date_submitted|date:'Y-m-d' }}
  {% endif %}
  {% if comment.doi_string %}&nbsp; <small>{{ comment|citation }}</small>{% endif %}

  {% if user.is_authenticated %}
    {% with type_id=comment|content_type_id %}
      {% include 'helpdesk/_ticket_for_object_link.html' with type_id=type_id id=comment.id model="Comment" %}
    {% endwith %}
  {% endif %}

  {% if comment|is_reply_to_comment %}
    <br>
    (in reply to <a href="{{ comment.content_object.get_absolute_url }}">{% if comment.content_object.anonymous %}Anonymous Comment{% else %}{{ comment.content_object.author.user.first_name }} {{ comment.content_object.author.user.last_name }}{% endif %}</a> on {{ comment.content_object.date_submitted|date:'Y-m-d' }})
  {% elif comment|is_reply_to_report %}
    <br>
    (in reply to
    <a href="{{ comment.content_object.get_absolute_url }}">Report {{ comment.content_object.report_nr }}{% if not comment.content_object.anonymous %} by {{ comment.content_object.author.user.first_name }} {{ comment.content_object.author.user.last_name }}{% endif %}</a>

    on {{ comment.content_object.date_submitted|date:'Y-m-d' }})
  {% endif %}
</div>
