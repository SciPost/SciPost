{% extends 'scipost/base.html' %}

{% block pagetitle %}: reply to comment{% endblock pagetitle %}

{% block bodysup %}

<script>
  $(document).ready(function(){

    var comment_text_input = $("#id_comment_text");

    function set_comment_text(value) {
      $("#preview-comment_text").text(value)
    }
    set_comment_text(comment_text_input.val())

    comment_text_input.keyup(function(){
      var new_text = $(this).val()
      set_comment_text(new_text)
      MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    })

  });
</script>


{% if user.is_authenticated %}
<section>
  <hr class="hr12">
  <h1>SciPost Reply to Comment Page</h1>
  <hr class="hr12">
  {% if comment.commentary %}
  <h1>The Commentary concerned:</h1>
  {{ commentary.header_as_table }}
  <h3>Abstract:</h3>
  <p>{{ commentary.pub_abstract }}</p>
  {% endif %}
  {% if comment.submission %}
  <h1>The Submission concerned:</h1>
  {{ submission.header_as_table }}
  <h3>Abstract:</h3>
  <p>{{ submission.abstract }}</p>
  {% endif %}  
  {% if comment.thesislink %}
  <h1>The Thesis concerned:</h1>
  {{ thesislink.header_as_table }}
  <h3>Abstract:</h3>
  <p>{{ thesislink.abstract }}</p>
  {% endif %}  
  <br>
  
  <hr class="hr6">
  <h2>The Comment you wish to reply to:</h2>

   <div class="flex-container">
      <div class="flex-commentbox">
	{{ comment.print_identifier }}
	{{ comment.categories_as_ul }}
        <div class="opinionsDisplay">
	  {{ comment.opinions_as_ul }}
	</div>
      </div>
   </div>
   <div class="row">
     <div class="col-1"></div>
     <div class="col-10">
       <p>{{ comment.comment_text|linebreaks }}</p>
     </div>
   </div>

  <hr class="hr6">
  <h1>Your Reply to this Comment:</h1>
  {% if is_author %}
  <h3>(you are identified as an author, your reply will appear as an author reply)</h3>
  {% else %}
  <h3>(you are not identified as an author of this publication; if you are, you can claim authorship on your Personal Page)</h3>
  {% endif %}
  <form action="{% url 'comments:reply_to_comment' comment.id %}" method="post">
    {% csrf_token %}
    {% load crispy_forms_tags %}
    {% crispy form %}
  </form>

  <div class="row">
    <div class="col-10">
      <h3>Preview of your comment:</h3>
      <p id="preview-comment_text"></p>
    </div>
  </div>

</section>
{% endif %}

{% endblock bodysup %}
