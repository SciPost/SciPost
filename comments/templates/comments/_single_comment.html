{% load scipost_extras %}
{% load filename %}
{% load file_extentions %}
{% load user_groups %}

{% is_edcol_admin request.user as is_edcol_admin %}
{% is_editorial_college request.user as is_editorial_college %}

<div class="comment">
    {% include 'comments/_comment_identifier.html' with comment=comment %}

    {% include 'comments/_comment_categories.html' with comment=comment %}

    {% include 'comments/_comment_voting_form.html' with comment=comment perms=perms user=user %}

    <p class="my-3 pb-2">
        {{ comment.comment_text|linebreaksbr }}

        {% if comment.file_attachment %}
            <h3>Attachment:</h3>
            <p>
                <a target="_blank" href="{{ comment.get_attachment_url }}">
                    {% if comment.file_attachment|is_image %}
                        <img class="attachment attachment-comment" src="{{ comment.get_attachment_url }}">
                    {% else %}
                        {{ comment.file_attachment|filename }}<br><small>{{ comment.file_attachment.size|filesizeformat }}</small>
                    {% endif %}
                </a>
            </p>
        {% endif %}
    </p>
    {% if is_editorial_college or is_edcol_admin %}
        {% if comment.remarks_for_editors %}
            <h3>Remarks for editors:</h3>
            <p>{{ comment.remarks_for_editors|linebreaks }}</p>
        {% endif %}
    {% endif %}

    {% for reply in comment.nested_comments.vetted %}
        {% include 'comments/_single_comment.html' with comment=reply perms=perms user=user %}
    {% endfor %}

    {% block comment_footer %}{% endblock %}
</div>
