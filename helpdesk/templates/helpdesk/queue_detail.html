{% extends 'helpdesk/base.html' %}

{% load bootstrap %}
{% load guardian_tags %}
{% load restructuredtext %}

{% block breadcrumb_items %}
    {{ block.super }}
<span class="breadcrumb-item">Queue details</span>
{% endblock %}

{% block pagetitle %}: Queue details{% endblock pagetitle %}

{% get_obj_perms request.user for queue as "user_perms" %}

{% block content %}

<div class="row">
  <div class="col-12">

    <h3 class="highlight">Queue {{ queue.name }}</h3>

    {% if queue.parent_queue %}
    <p>Parent: <a href="{% url 'helpdesk:queue_detail' slug=queue.parent_queue.slug %}">{{ queue.parent_queue }}</a></p>
    {% endif %}
    {% if queue.sub_queues.all|length > 0 %}
    <p>Sub-queues: {% for sub in queue.sub_queues.all %}<a href="{% url 'helpdesk:queue_detail' slug=sub.slug %}">{{ sub }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}</p>
    {% endif %}

    {% if perms.helpdesk.add_queue or request.user in queue.managing_group.users.all %}
    <div class="container border border-danger">
      <h4>Admin actions:</h4>
      <ul>
	{% if perms.helpdesk.update_queue or "update_queue" in user_perms %}
	<li><a href="{% url 'helpdesk:queue_update' slug=queue.slug %}" class="text-warning">Update this Queue</a></li>
	{% endif %}
	{% if perms.helpdesk.delete_queue or "delete_queue" in user_perms %}
	<li><a href="{% url 'helpdesk:queue_delete' slug=queue.slug %}" class="text-danger">Delete this Queue</a></li>
	{% endif %}
	{% if perms.helpdesk.add_queue or request.user in queue.managing_group.users.all %}
	<li><a href="{% url 'helpdesk:queue_create' parent_slug=queue.slug %}">Add a sub-Queue to this Queue</a></li>
	{% endif %}
      </ul>
    </div>
    {% endif %}

    <h3 class="highlight">Description</h3>
    {{ queue.description|restructuredtext }}

    <h3 class="highlight">Tickets in this Queue</h3>
    {% include 'helpdesk/tickets_table.html' with queue=queue %}

  </div>
</div>

{% endblock content %}
