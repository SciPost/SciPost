{% extends 'production/partials/production_stream_card_completed.html' %}

{% load bootstrap %}

{% block actions %}
    {% include 'production/partials/stream_status_changes.html' with form=status_form stream=stream %}

  <h3>Events</h3>
  {% include 'production/partials/production_events.html' with events=stream.events.all %}

  {% if "can_work_for_stream" in sub_perms and prodevent_form %}
    <h3>Add message to the Stream</h3>
    <form action="{% url 'production:add_event' stream_id=stream.id %}" method="post" class="mb-2">
        {% csrf_token %}
        {{ prodevent_form|bootstrap }}
        <input type="submit" class="btn btn-secondary" name="submit" value="Submit">
    </form>
  {% endif %}

  <h3>Work Log</h3>
  {% if "can_work_for_stream" in sub_perms and work_log_form %}
    <ul>
        <li>
            <a href="javascript:;" data-toggle="toggle" data-target="#log_form">Add hours to the Stream</a>
            <form id="log_form" style="display: none;" action="{% url 'production:add_event' stream_id=stream.id %}" method="post" class="mb-2">
                {% csrf_token %}
                {{ work_log_form|bootstrap }}
                <input type="submit" class="btn btn-secondary" name="submit" value="Log">
            </form>
        </li>
    </ul>
  {% endif %}

  {% include 'partials/finances/logs.html' with logs=stream.work_logs.all %}

    {% if "can_perform_supervisory_actions" in sub_perms or "can_work_for_stream" in sub_perms %}
          <h3>Actions</h3>
          <ul>
              {% if "can_perform_supervisory_actions" in sub_perms %}
                  {% if perms.scipost.can_assign_production_supervisor and assign_supervisor_form %}
                      <li>
                          <a href="javascript:;" data-toggle="toggle" data-target="#add_supervisor_{{stream.id}}">Assign Production Supervisor to this stream</a>
                          <div id="add_supervisor_{{stream.id}}" style="display: none;">
                              <form class="my-3" action="{% url 'production:add_supervisor' stream_id=stream.id %}" method="post">
                                  {% csrf_token %}
                                  {{ assign_supervisor_form|bootstrap_inline }}
                                  <input type="submit" class="btn btn-outline-primary" name="submit" value="Add supervisor">
                              </form>
                          </div>
                      </li>
                  {% endif %}
                  {% if perms.scipost.can_assign_production_officer %}
                      {% if assign_officer_form %}
                        <li>
                            <a href="javascript:;" data-toggle="toggle" data-target="#add_officer_{{stream.id}}">Assign Production Officer to this stream</a>
                            <div id="add_officer_{{stream.id}}" style="display: none;">
                                <form class="my-3" action="{% url 'production:add_officer' stream_id=stream.id %}" method="post">
                                  	{% csrf_token %}
                                  	{{ assign_officer_form|bootstrap_inline }}
                                  	<input type="submit" class="btn btn-outline-primary" name="submit" value="Add officer">
                                </form>
                            </div>
                        </li>
                    {% endif %}
                    {% if assign_officer_form %}
                        <li>
                            <a href="javascript:;" data-toggle="toggle" data-target="#add_invs_officer_{{stream.id}}">Assign Invitations Officer to this stream</a>
                            <div id="add_invs_officer_{{stream.id}}" style="display: none;">
                                <form class="my-3" action="{% url 'production:add_invitations_officer' stream_id=stream.id %}" method="post">
                                  	{% csrf_token %}
                                  	{{ assign_invitiations_officer_form|bootstrap_inline }}
                                  	<input type="submit" class="btn btn-outline-primary" name="submit" value="Add officer">
                                </form>
                            </div>
                        </li>
                    {% endif %}
                  {% endif %}
              {% endif %}

              {% if "can_work_for_stream" in sub_perms %}
                  {% if perms.scipost.can_upload_proofs and upload_proofs_form %}
                      <li>
                          <a href="javascript:;" data-toggle="toggle" data-target="#upload_proofs">Upload Proofs</a>
                          <div id="upload_proofs" style="display: none;">
                              <form class="my-3" action="{% url 'production:upload_proofs' stream_id=stream.id %}" method="post" enctype="multipart/form-data">
                                	{% csrf_token %}
                                	{{ upload_proofs_form|bootstrap_inline }}
                                	<input type="submit" class="btn btn-outline-primary" name="submit" value="Upload">
                              </form>
                          </div>
                      </li>
                  {% endif %}
              {% endif %}

              {% if perms.scipost.can_publish_accepted_submission %}
                  {% if not stream.submission.publication %}
                    <li><a href="{% url 'journals:initiate_publication' %}">Initiate the publication process</a></li>
                  {% endif %}
                    <li><a href="{% url 'production:mark_as_completed' stream_id=stream.id %}">Mark this stream as completed</a></li>
              {% endif %}
          </ul>
    {% endif %}
{% endblock %}

{% block officers %}
    <li>Production Supervisor:
          {% if stream.supervisor %}
              <strong>{{ stream.supervisor }}</strong>
              {% if perms.scipost.can_assign_production_supervisor %}
                  &middot; <a href="{% url 'production:remove_supervisor' stream_id=stream.id officer_id=stream.supervisor.id %}" class="text-danger">Remove from stream</a>
              {% endif %}
          {% else %}
              <em>No Supervisor assigned yet.</em>
          {% endif %}
    </li>
    <li>Production Officer:
          {% if stream.officer %}
              <strong>{{ stream.officer }}</strong>
              {% if "can_work_for_stream" in sub_perms and perms.scipost.can_assign_production_officer %}
                  &middot; <a href="{% url 'production:remove_officer' stream_id=stream.id officer_id=stream.officer.id %}" class="text-danger">Remove from stream</a>
              {% endif %}
          {% else %}
              <em>No Officer assigned yet.</em>
          {% endif %}
    </li>
    <li>Invitations Officer:
          {% if stream.invitations_officer %}
              <strong>{{ stream.invitations_officer }}</strong>
              {% if "can_work_for_stream" in sub_perms and perms.scipost.can_assign_production_officer %}
                  &middot; <a href="{% url 'production:remove_invitations_officer' stream_id=stream.id officer_id=stream.invitations_officer.id %}" class="text-danger">Remove from stream</a>
              {% endif %}
          {% else %}
              <em>No Invitations Officer assigned yet.</em>
          {% endif %}
    </li>
{% endblock %}
