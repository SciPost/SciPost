{% extends 'production/partials/production_stream_card_completed.html' %}

{% load bootstrap %}
{% load guardian_tags %}

{% get_obj_perms request.user for stream as "sub_perms" %}

{% block actions %}
  <h3>Events</h3>
  {% include 'production/partials/production_events.html' with events=stream.events.all %}

  {% if perms.scipost.can_publish_accepted_submission or perms.scipost.can_assign_production_supervisor or "can_perform_supervisory_actions" in sub_perms %}
      <h3>Actions</h3>
      <ul>
          {% if perms.scipost.can_assign_production_supervisor and assign_supervisor_form %}
              <li>
                  <a href="javascript:;" data-toggle="toggle" data-target="#add_supervisor_{{stream.id}}">Assign Production Supervisor to this stream</a>
                  <div id="add_supervisor_{{stream.id}}" style="display: none;">
                      <form class="my-3" action="{% url 'production:add_supervisor' stream_id=stream.id %}" method="post">
                          {% csrf_token %}
                          {{ assign_supervisor_form|bootstrap_inline }}
                          <input type="submit" class="btn btn-outline-primary" name="submit" value="Add officer">
                      </form>
                  </div>
              </li>
          {% endif %}
          {% if "can_perform_supervisory_actions" in sub_perms and assign_officer_form %}
            <li>
                <a href="javascript:;" data-toggle="toggle" data-target="#add_officer_{{stream.id}}">Assign Production Officer to this stream</a>
                <div id="add_officer_{{stream.id}}" style="display: none;">
                    <form class="my-3" action="{% url 'production:add_officer' stream_id=stream.id %}" method="post">
                      	{% csrf_token %}
                      	{{ assign_officer_form|bootstrap_inline }}
                      	<input type="submit" class="btn btn-outline-primary" name="submit" value="Add officer">
                    </form>
                </div>
            </li>
          {% endif %}
          {% if perms.scipost.can_publish_accepted_submission %}
            <li><a href="{% url 'production:mark_as_completed' stream_id=stream.id %}">Mark this stream as completed</a></li>
          {% endif %}
      </ul>
  {% endif %}
{% endblock %}

{% block officers %}
    <li>Production Supervisor:
          {% if stream.supervisor %}
              <strong>{{ stream.supervisor }}</strong>
              {% if perms.scipost.can_assign_production_supervisor %}
                  &middot; <a href="{% url 'production:remove_supervisor' stream_id=stream.id officer_id=stream.supervisor.id %}" class="text-danger">Remove from stream</a>
              {% endif %}
          {% else %}
              <em>No Supervisor assigned yet.</em>
          {% endif %}
    </li>
    <li>Production Officer:
          {% if stream.officer %}
              <strong>{{ stream.officer }}</strong>
              {% if "can_perform_supervisory_actions" in sub_perms %}
                  &middot; <a href="{% url 'production:remove_officer' stream_id=stream.id officer_id=stream.officer.id %}" class="text-danger">Remove from stream</a>
              {% endif %}
          {% else %}
              <em>No Officer assigned yet.</em>
          {% endif %}
    </li>
{% endblock %}
