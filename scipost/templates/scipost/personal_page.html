{% extends 'scipost/base.html' %}

{% load bootstrap %}
{% load user_groups %}

{% block pagetitle %}: personal page{% endblock pagetitle %}

{% block body_class %}{{ block.super }} personal-page{% endblock %}

{% block content %}

  <h1 class="highlight">Welcome to your SciPost Personal Page{% if appellation %}, {{ appellation }}{% endif %}</h1>

  {% if needs_validation %}

    <div class="row">
      <div class="col-12">
        <hr>
        <h3>Your credentials will soon be verified by an Editor.</h3>
        <p>If accepted, you will become a registered Contributor, enabling you to submit, comment and vote.</p>
      </div>
    </div>

  {% else %}
    {# Save all Permission groups into template variables #}
    {% is_edcol_admin request.user as is_edcol_admin %}
    {% is_scipost_admin request.user as is_scipost_admin %}
    {% is_financial_admin request.user as is_financial_admin %}
    {% is_editorial_college request.user as is_editorial_college %}
    {% is_advisory_board request.user as is_advisory_board %}
    {% is_vetting_editor request.user as is_vetting_editor %}
    {% is_ambassador request.user as is_ambassador %}
    {% is_junior_ambassador request.user as is_junior_ambassador %}
    {% is_registered_contributor request.user as is_registered_contributor %}
    {% is_tester request.user as is_tester %}
    {% is_production_officer request.user as is_production_officer %}

    <div class="row">
      <div class="col-12">
        <div class="tab-nav-container dynamic">
          <div class="tab-nav-inner">
            <!-- Nav tabs -->
            <ul class="nav btn-group personal-page-nav" role="tablist">
              <li class="nav-item btn btn-outline-secondary">
                <a class="nav-link" {% if tab == 'account' %}data-sp-autoload='true'{% endif %} href="#account" data-sp-dynamic-load="{% url 'scipost:personal_page_account' %}" data-toggle="tab">Account</a>
              </li>
	      {% if is_scipost_admin or is_financial_admin or perms.scipost.can_vet_registration_requests %}
		<li class="nav-item btn btn-outline-secondary">
		  <a class="nav-link" {% if tab == 'admin_actions' %}data-sp-autoload='true'{% endif %} href="#admin-actions" data-sp-dynamic-load="{% url 'scipost:personal_page_admin_actions' %}" data-toggle="tab">Admin Actions</a>
		</li>
	      {% endif %}
              {% if is_scipost_admin or is_edcol_admin or is_editorial_college or is_advisory_board or is_vetting_editor or is_ambassador or is_junior_ambassador %}
                <li class="nav-item btn btn-outline-secondary">
                  <a class="nav-link" {% if tab == 'editorial_actions' %}data-sp-autoload='true'{% endif %} href="#editorial-actions" data-sp-dynamic-load="{% url 'scipost:personal_page_editorial_actions' %}" data-toggle="tab">Editorial Actions</a>
                </li>
              {% endif %}
              {% if perms.scipost.can_referee %}
                <li class="nav-item btn btn-outline-secondary">
                  <a class="nav-link" {% if tab == 'refereeing' %}data-sp-autoload='true'{% endif %} data-toggle="tab" href="#refereeing" data-sp-dynamic-load="{% url 'scipost:personal_page_refereeing' %}">Refereeing {% if refereeing_tab_total_count %}({{refereeing_tab_total_count}}){% endif %}</a>
                </li>
              {% endif %}
              {% if contributor %}
                {# If user is contributor #}
                <li class="nav-item btn btn-outline-secondary">
                  <a class="nav-link" {% if tab == 'publications' %}data-sp-autoload='true'{% endif %} data-toggle="tab" data-sp-dynamic-load="{% url 'scipost:personal_page_publications' %}" href="#publications">Publications</a>
                </li>
                <li class="nav-item btn btn-outline-secondary">
                  <a class="nav-link" {% if tab == 'submissions' %}data-sp-autoload='true'{% endif %} data-toggle="tab" data-sp-dynamic-load="{% url 'scipost:personal_page_submissions' %}" href="#submissions">Submissions</a>
                </li>
                <li class="nav-item btn btn-outline-secondary">
                  <a class="nav-link" {% if tab == 'commentaries' %}data-sp-autoload='true'{% endif %} data-toggle="tab" data-sp-dynamic-load="{% url 'scipost:personal_page_commentaries' %}" href="#commentaries">Commentaries</a>
                </li>
                <li class="nav-item btn btn-outline-secondary">
                  <a class="nav-link" {% if tab == 'theses' %}data-sp-autoload='true'{% endif %} data-toggle="tab" data-sp-dynamic-load="{% url 'scipost:personal_page_theses' %}" href="#theses">Theses</a>
                </li>
                <li class="nav-item btn btn-outline-secondary">
                  {% with contributor.comments.regular_comments.awaiting_vetting.count as count %}
                    <a class="nav-link" {% if tab == 'comments' %}data-sp-autoload='true'{% endif %} data-toggle="tab" data-sp-dynamic-load="{% url 'scipost:personal_page_comments' %}" href="#comments">Comments{% if count %} ({{count}} unvetted){% endif %}</a>
                  {% endwith %}
                </li>
                <li class="nav-item btn btn-outline-secondary">
                  {% with contributor.comments.author_replies.awaiting_vetting.count as count %}
                    <a class="nav-link" {% if tab == 'author_replies' %}data-sp-autoload='true'{% endif %} data-toggle="tab" data-sp-dynamic-load="{% url 'scipost:personal_page_author_replies' %}" href="#author-replies">Author Replies{% if count %} ({{count}} unvetted){% endif %}</a>
                  {% endwith %}
                </li>
                {# END: If user is contributor #}
              {% endif %}
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-content">
      <!-- Tab: Account -->
      <div class="tab-pane active" id="account" role="tabpanel">
      </div><!-- End tab -->

      {% if is_scipost_admin %}
	<!-- Tab: Admin Actions -->
	<div class="tab-pane" id="admin-actions" role="tabpanel">
	</div>
      {% endif %}

      {% if is_scipost_admin or is_edcol_admin or is_editorial_college or is_advisory_board or is_vetting_editor or is_ambassador or is_junior_ambassador %}
        <!-- Tab: Editorial Actions -->
        <div class="tab-pane" id="editorial-actions" role="tabpanel">
        </div><!-- End tab -->
      {% endif %}

      {% if contributor %}
        <!-- Tab: Publications -->
        <div class="tab-pane" id="publications" role="tabpanel">
        </div><!-- End tab -->


        {% if perms.scipost.can_referee %}
          <!-- Tab: Refereeing -->
          <div class="tab-pane" id="refereeing" role="tabpanel">
          </div><!-- End tab -->
        {% endif %}

        <!-- Tab: Submissions -->
        <div class="tab-pane" id="submissions" role="tabpanel">
        </div><!-- End tab -->

        <!-- Tab: Commentaries -->
        <div class="tab-pane" id="commentaries" role="tabpanel">
        </div><!-- End tab -->

        <!-- Tab: Theses -->
        <div class="tab-pane" id="theses" role="tabpanel">
        </div><!-- End tab -->

        <!-- Tab: Comments -->
        <div class="tab-pane" id="comments" role="tabpanel">
        </div><!-- End tab -->

        <!-- Tab: Author Replies -->
        <div class="tab-pane" id="author-replies" role="tabpanel">
        </div><!-- End tab -->

      {% endif %}
    </div>

  {% endif %}

{% endblock content %}
