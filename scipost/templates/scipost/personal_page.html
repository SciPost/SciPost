{% extends 'scipost/base.html' %}

{% load bootstrap %}
{% load user_groups %}

{% block pagetitle %}: personal page{% endblock pagetitle %}

{% block breadcrumb %}
    <div class="container-outside header">
        <div class="container">
            <h1>Welcome to your SciPost Personal Page{% if appellation %}, {{ appellation }}{% endif %}</h1>
        </div>
    </div>
{% endblock %}

{% block content %}

    {% if needs_validation %}

        <div class="row">
            <div class="col-12">
              <hr class="hr12">
              <h3>Your credentials will soon be verified by an Editor.</h3>
              <p>If accepted, you will become a registered Contributor, enabling you to submit, comment and vote.</p>
            </div>
        </div>

    {% else %}
        {# Save all Permission groups into template variables #}
            {% is_edcol_admin request.user as is_edcol_admin %}
            {% is_scipost_admin request.user as is_scipost_admin %}
            {% is_editorial_college request.user as is_editorial_college %}
            {% is_advisory_board request.user as is_advisory_board %}
            {% is_vetting_editor request.user as is_vetting_editor %}
            {% is_ambassador request.user as is_ambassador %}
            {% is_junior_ambassador request.user as is_junior_ambassador %}
            {% is_registered_contributor request.user as is_registered_contributor %}
            {% is_tester request.user as is_tester %}
            {% is_production_officer request.user as is_production_officer %}

        <div class="row">
            <div class="col-12">
                <div class="tab-nav-container">
                    <div class="tab-nav-inner">
                        <!-- Nav tabs -->
                        <ul class="nav btn-group personal-page-nav" role="tablist">
                          <li class="nav-item btn btn-secondary">
                            <a class="nav-link" {% if tab == 'account' %}sp-autoload='true'{% endif %} href="#account" sp-dynamic-load="{% url 'scipost:personal_page_account' %}" data-toggle="tab">Account</a>
                          </li>
                          {% if is_scipost_admin or is_edcol_admin or is_editorial_college or is_advisory_board or is_vetting_editor or is_ambassador or is_junior_ambassador %}
                              <li class="nav-item btn btn-secondary">
                                <a class="nav-link" {% if tab == 'editorial_actions' %}sp-autoload='true'{% endif %} href="#editorial-actions" sp-dynamic-load="{% url 'scipost:personal_page_editorial_actions' %}" data-toggle="tab">Editorial Actions</a>
                              </li>
            		      {% endif %}
                          {% if perms.scipost.can_referee %}
                              <li class="nav-item btn btn-secondary">
                                <a class="nav-link" {% if tab == 'refereeing' %}sp-autoload='true'{% endif %} data-toggle="tab" href="#refereeing" sp-dynamic-load="{% url 'scipost:personal_page_refereeing' %}">Refereeing {% if refereeing_tab_total_count %}({{refereeing_tab_total_count}}){% endif %}</a>
                              </li>
                          {% endif %}
                          {% if contributor %}
                          {# If user is contributor #}
                              <li class="nav-item btn btn-secondary">
                                <a class="nav-link" {% if tab == 'publications' %}sp-autoload='true'{% endif %} data-toggle="tab" sp-dynamic-load="{% url 'scipost:personal_page_publications' %}" href="#publications">Publications</a>
                              </li>
                              <li class="nav-item btn btn-secondary">
                                <a class="nav-link" {% if tab == 'submissions' %}sp-autoload='true'{% endif %} data-toggle="tab" sp-dynamic-load="{% url 'scipost:personal_page_submissions' %}" href="#submissions">Submissions</a>
                              </li>
                              <li class="nav-item btn btn-secondary">
                                <a class="nav-link" {% if tab == 'commentaries' %}sp-autoload='true'{% endif %} data-toggle="tab" sp-dynamic-load="{% url 'scipost:personal_page_commentaries' %}" href="#commentaries">Commentaries</a>
                              </li>
                              <li class="nav-item btn btn-secondary">
                                <a class="nav-link" {% if tab == 'theses' %}sp-autoload='true'{% endif %} data-toggle="tab" sp-dynamic-load="{% url 'scipost:personal_page_theses' %}" href="#theses">Theses</a>
                              </li>
                              <li class="nav-item btn btn-secondary">
                                  {% with contributor.comments.regular_comments.awaiting_vetting.count as count %}
                                    <a class="nav-link" {% if tab == 'comments' %}sp-autoload='true'{% endif %} data-toggle="tab" sp-dynamic-load="{% url 'scipost:personal_page_comments' %}" href="#comments">Comments{% if count %} ({{count}} unvetted){% endif %}</a>
                                  {% endwith %}
                              </li>
                              <li class="nav-item btn btn-secondary">
                                  {% with contributor.comments.author_replies.awaiting_vetting.count as count %}
                                    <a class="nav-link" {% if tab == 'author_replies' %}sp-autoload='true'{% endif %} data-toggle="tab" sp-dynamic-load="{% url 'scipost:personal_page_author_replies' %}" href="#author-replies">Author Replies{% if count %} ({{count}} unvetted){% endif %}</a>
                                  {% endwith %}
                              </li>
                          {# END: If user is contributor #}
                          {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content">
            <!-- Tab: Account -->
            <div class="tab-pane active" id="account" role="tabpanel">
            </div><!-- End tab -->

            {% if is_scipost_admin or is_edcol_admin or is_editorial_college or is_advisory_board or is_vetting_editor or is_ambassador or is_junior_ambassador %}
                <!-- Tab: Editorial Actions -->
                <div class="tab-pane" id="editorial-actions" role="tabpanel">
                </div><!-- End tab -->
            {% endif %}

            {% if contributor %}
            {# If user is contributor #}
                <!-- Tab: Publications -->
                <div class="tab-pane" id="publications" role="tabpanel">
                </div><!-- End tab -->


                {% if perms.scipost.can_referee %}
                    <!-- Tab: Refereeing -->
                    <div class="tab-pane" id="refereeing" role="tabpanel">
                    </div><!-- End tab -->
                {% endif %}

                <!-- Tab: Submissions -->
                <div class="tab-pane" id="submissions" role="tabpanel">
                </div><!-- End tab -->

                <!-- Tab: Commentaries -->
                <div class="tab-pane" id="commentaries" role="tabpanel">
                </div><!-- End tab -->

                <!-- Tab: Theses -->
                <div class="tab-pane" id="theses" role="tabpanel">
                </div><!-- End tab -->

                <!-- Tab: Comments -->
                <div class="tab-pane" id="comments" role="tabpanel">
                </div><!-- End tab -->

                <!-- Tab: Author Replies -->
                <div class="tab-pane" id="author-replies" role="tabpanel">
                </div><!-- End tab -->

            {# END: If user is contributor #}
            {% endif %}
        </div>

    {% endif %}

{% endblock content %}
