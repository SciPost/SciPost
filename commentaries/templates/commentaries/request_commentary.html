{% extends 'scipost/base.html' %}

{% block pagetitle %}: request Commentary{% endblock pagetitle %}

{% block bodysup %}

{% load scipost_extras %}

  <script>
  $(document).ready(function(){

    var allToggableRows = $('tr').slice(1)

    var preprint = [5,6,7,8,10]
    var published = [9]

    function show(indices){
      allToggableRows.each(function(index){
        if ($.inArray( index, indices) != -1){
          $(this).hide()
        }else{
          $(this).show()
        }

      })
    }

//    if ($('select#id_type').val() == "") {
//      allToggableRows.each(function(index){
//      $(this).hide()
//      })
//    }

    switch ($('select#id_type').val()) {
     case "":
       allToggableRows.hide()
       $("#DOIprefill").hide();
       $("#arXivprefill").hide();
       break;
     case "published":
       show(published)
       $("#DOIprefill").show()
       $("#arXivprefill").hide();
       break;
     case "preprint":
       show(preprint)
       $("#DOIprefill").hide()
       $("#arXivprefill").show();
       break;
     default:
       allToggableRows.hide()
       $("#DOIprefill").hide();
       $("#arXivprefill").hide();
    }

    $('select#id_type').on('change', function() {
      var selection = $(this).val();
      switch(selection){
        case "published":
          show(published)
          $("#DOIprefill").show()
          $("#arXivprefill").hide();
          break;
        case "preprint":
          show(preprint)
          $("#DOIprefill").hide()
          $("#arXivprefill").show();
          break;
        default:
          $("#DOIprefill").hide()
          $("#arXivprefill").hide();
          allToggableRows.hide()
      }
    });
  });
</script>

<section>
  <div class="flex-greybox">
    <h1>Request Activation of a Commentary Page:</h1>
  </div>
  {% if errormessage %}
  <h3 style="color: red;">Error: {{ errormessage }}</h3>
  {% if existing_commentary %}
  <ul>{{ existing_commentary.header_as_li }}</ul>
  {% endif %}
  <br/>
  {% endif %}

  <div id="DOIprefill">
    <h3><em>For published papers, you can prefill the form (except for domain, subject area and abstract) using the DOI:</em></h3>
    <p><em>(give the DOI as 10.[4 to 9 digits]/[string], without prefix, as per the placeholder)</em></p>
    <form action="{% url 'commentaries:prefill_using_DOI' %}" method="post">
      {% csrf_token %}
      {{ doiform }}
      <input type="submit" value="Query DOI"/>
    </form>
  </div>
  <div id="arXivprefill">
    <h3><em>For preprints, you can prefill the form using the arXiv identifier:</em></h3>
    <p><em>(give the identifier without prefix, as per the placeholder)</em></p>
    <form action="{% url 'commentaries:prefill_using_identifier' %}" method="post">
      {% csrf_token %}
      {{ identifierform }}
      <input type="submit" value="Query arXiv"/>
    </form>
  </div>
  <br/>
  <form action="{% url 'commentaries:request_commentary' %}" method="post">
    {% csrf_token %}
    <table>
      {{ form.as_table }}
    </table>
    <input type="submit" value="Submit"/>
  </form>

</section>

{% endblock bodysup %}
