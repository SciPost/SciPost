{% load staticfiles %}
<link rel="stylesheet" type="text/css" href="{% static 'scipost/SciPost.css' %}" />
<!--<script type="text/javascript" src="{% static 'js/jquery.js' %}"></script> -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

{% load mathjax %}
{% mathjax_scripts %}


  <script>
    $(document).ready(function(){
    $("#commentsbutton").click(function(){
    $("#commentslist").toggle();
    });
    $("#ratingsbutton").click(function() {
    $(".ratingsdata").toggle();
    });
    });
  </script>


{% include 'scipost/header.html' %}
{% include 'scipost/navbar.html' %}


<section>
  <div class="row">
    <div class="col-11">
      <h1>SciPost Commentary Page &nbsp; (for non-SciPost publications)</h1>
    </div>
    <div class="col-1">
      <br/>
      <button id="ratingsbutton">Toggle ratings view</button>
    </div>
  </div>
</section>

<section>
  <div class="row">
    <div class="col-4">
      <h2>Original publication: </h2>
    </div>
    <div class="col-8">
      <ul class="ratingsdata">
	<li>Ratings: </li>
	<li>clarity: {{ commentary.clarity_rating }}% ({{ commentary.nr_clarity_ratings }})</li>
	<li>validity: {{ commentary.validity_rating }}% ({{ commentary.nr_validity_ratings }})</li>
	<li>rigour: {{ commentary.rigour_rating }}% ({{ commentary.nr_rigour_ratings }})</li>
	<li>originality: {{ commentary.originality_rating }}% ({{ commentary.nr_originality_ratings }})</li>
	<li>significance: {{ commentary.significance_rating }}% ({{ commentary.nr_significance_ratings }})</li>
      </ul>

    </div>
  </div>

  <br>
  <table>
    <tr><td>Title: </td><td>{{ commentary.pub_title }}</td></tr>
    <tr><td>Author(s): </td><td>{{ commentary.author_list }}</td></tr>
    <tr><td>arXiv link: </td><td><a href="{{ commentary.arxiv_link }}">{{ commentary.arxiv_link }}</a></td></tr>
    <tr><td>DOI Link: </td><td><a href="{{ commentary.pub_DOI_link }}">{{ commentary.pub_DOI_link }}</a></td></tr>
    <tr><td>Date published: </td><td>{{ commentary.pub_date }}</td></tr>
  </table>
  <br />
  <h3>Abstract:</h3>
  <p>{{ commentary.pub_abstract }}</p>
  
  {% if user.is_authenticated and user.contributor.rank > 0 %}
  <form action="{% url 'ratings:vote_on_commentary' commentary_id=commentary.id %}" method="post" class="ratingsdata">
    {% csrf_token %}
    <ul>
      <li>Rate this publication:</li>
      {{ commentary_rating_form.as_ul }}	  
      <li><input type="submit" value="Submit"></li>
    </ul>
    
  </form>
  {% endif %}

</section>

{% if reports %}
<section>
  <h2>Reports on this publication</h2>
  <hr>
</section>
{% endif %}

{% if comments %}
<section>
  <div class="row">
    <div class="col-10">
      <h2>Comments on this publication</h2>
    </div>
    <div class="col-2">
      <button id="commentsbutton">Toggle comments/ratings view</button>
    </div>
  </div>
  <hr>

  <div id="commentslist">
  {% for comment in comments %}
  <div class="row">

    <div class="col-4">
      <h3>{{ comment.id }} &nbsp; {% if comment.in_reply_to %} (in reply to {{ comment.in_reply_to.id }}) {% endif %}</h3>
      <h4>Date: {{ comment.date_submitted }}</h4>
    </div>

    <div class="col-8">
      <ul class="commentcategorydisplay">
	<li>Categories:</li>
	{% if comment.is_rem %}<li>remark</li>{% endif %}
	{% if comment.is_que %}<li>question</li>{% endif %}
	{% if comment.is_ans %}<li>answer to question</li>{% endif %}
	{% if comment.is_obj %}<li>objection</li>{% endif %}
	{% if comment.is_rep %}<li>reply to objection</li>{% endif %}
	{% if comment.is_val %}<li>validation or rederivation</li>{% endif %}
	{% if comment.is_lit %}<li>pointer to related literature</li>{% endif %}
	{% if comment.is_sug %}<li>suggestion for further work</li>{% endif %}
      </ul>
      <br/><br/>
      <ul class="ratingsdata">
	<li>Ratings: </li>
	<li>relevance: {{ comment.relevance_rating }}% ({{ comment.nr_relevance_ratings }})</li>
	<li>importance: {{ comment.importance_rating }}% ({{ comment.nr_importance_ratings }})</li>
	<li>clarity: {{ comment.clarity_rating }}% ({{ comment.nr_clarity_ratings }})</li>
	<li>validity: {{ comment.validity_rating }}% ({{ comment.nr_validity_ratings }})</li>
	<li>rigour: {{ comment.rigour_rating }}% ({{ comment.nr_rigour_ratings }})</li>
      </ul>
    </div>
  </div>

  <div class="row">
<!--    <div class="col-1"></div> -->
    <div class="col-10">
      <p>{{ comment.comment_text|linebreaks }}</p>
    </div>
  </div>

  {% if user.is_authenticated and user.contributor.rank > 0 %}
  <div class="row">
<!--    <div class="col-1"></div> -->
    <div class="col-10">
      <form action="{% url 'ratings:vote_on_comment' comment_id=comment.id %}" method="post" class="ratingsdata">
	{% csrf_token %}
	<ul>
	  <li>Rate this comment:</li>
	  {{ comment_rating_form.as_ul }}	  
	  <li><input type="submit" value="Submit"></li>
	</ul>	
      </form>
    </div>
  </div>
  {% endif %}

  {% for reply in author_replies %}
  {% if reply.in_reply_to_comment.id = comment.id %}

  <div class="row">
    <div class="col-1"></div>
    <hr style="border-style: dotted;" />
    <div class="col-3">
      <h3>Author reply ({{ reply.date_submitted }}):</h3>
    </div>
    <div class="col-8">
      <ul class="ratingsdata">
	<li>Ratings: </li>
	<li>relevance: {{ reply.relevance_rating }}% ({{ reply.nr_relevance_ratings }})</li>
	<li>importance: {{ reply.importance_rating }}% ({{ reply.nr_importance_ratings }})</li>
	<li>clarity: {{ reply.clarity_rating }}% ({{ reply.nr_clarity_ratings }})</li>
	<li>validity: {{ reply.validity_rating }}% ({{ reply.nr_validity_ratings }})</li>
	<li>rigour: {{ reply.rigour_rating }}% ({{ reply.nr_rigour_ratings }})</li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-1"></div>
    <div class="col-10">
      <p>{{ reply.reply_text|linebreaks }}</p>
    </div>
  </div>
  {% if user.is_authenticated and user.contributor.rank > 0 %}
  <div class="row">
    <div class="col-1"></div>
    <div class="col-10">
      <form action="{% url 'ratings:vote_on_authorreply' authorreply_id=reply.id %}" method="post" class="ratingsdata">
	{% csrf_token %}
	<ul>
	  <li>Rate this author reply:</li>
	  {{ authorreply_rating_form.as_ul }}	  
	  <li><input type="submit" value="Submit"></li>
	</ul>	
      </form>
    </div>
  </div>
  {% endif %}

  {% endif %}
  {% endfor %}

  {% if user.is_authenticated and user.contributor.rank > 0 %}
  <hr style="border-style: dotted;" />
  <div class="row">
    <div class="col-6">
      <h3><a href="{% url 'comments:author_reply_to_comment' comment_id=comment.id %}">Reply to this comment (Author)</a></h3>
    </div>
    <div class="col-6">
      <h3><a href="{% url 'comments:reply_to_comment' comment_id=comment.id %}">Reply to this comment (Contributor)</a></h3>
    </div>
  </div>
  <hr>
  {% endif %}
  {% endfor %}
  </div id="commentslist">
</section>
{% endif %}

{% if user.is_authenticated and commentary.open_for_commenting and user.contributor.rank > 0 %}
<section>
  <div class="row">
    <div class="col-3">
      <h1>Contribute a Comment</h1>
      <p>Specify whick category your comment belongs to (you can choose more than one).</p>
      <p>In your comment, you can use LaTeX \$...\$ for in-text equations or &#92; &#91; ... &#92; &#93; for separate equations.</p>
    </div>
    <div class="col-9">
      <form action="{% url 'commentaries:commentary' commentary.id %}" method="post">
	{% csrf_token %}
	<div class="col-4">
	  <ul class="commentcategorychoices">
	    <li>{{ form.is_rem }} remark</li>
	    <li>{{ form.is_que }} question</li>
	    <li>{{ form.is_ans }} answer to question</li>
	    <li>{{ form.is_obj }} objection</li>
	    <li>{{ form.is_rep }} reply to objection</li>
	    <li>{{ form.is_val }} validation or rederivation</li>
	    <li>{{ form.is_lit }} pointer to related literature</li>
	    <li>{{ form.is_sug }} suggestion for further work</li>
	  </ul>
	</div>
	<div class="col-1"></div>
	<div class="col-7">
	  {{ form.comment_text }}
	  <input type="submit" value="Submit your Comment">
	</div>
      </form>
    </div>
  </div>
</section>
{% endif %}

<p>{{ debugnote }}</p>

{% include 'scipost/footer.html' %}
