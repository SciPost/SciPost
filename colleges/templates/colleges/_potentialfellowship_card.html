{% load bootstrap %}

{% load scipost_extras %}

<div class="card-body">
  <div class="row">
    <div class="col-12">
      <h3 class="highlight">Potential Fellowship details for {{ potfel }}</h3>
      <div id="profileAccordion">
	<div class="card">
	  <div class="card-header" id="potfelProfile">
	    <h4 class="mb-0">
	      <button class="btn btn-link" data-toggle="collapse" data-target="#collapseProfile" aria-expanded="true" aria-controls="collapseProfile">
		View Profile
	      </button>
	    </h4>
	  </div>
	  <div id="collapseProfile" class="collapse" aria-labelledby="potfelProfile" data-parent="#profileAccordion">
	    <div class="card-body">
	      {% include 'profiles/_profile_card.html' with profile=potfel.profile %}
	    </div>
	  </div>
	</div>
      </div>
    </div>
  </div>

  {% if perms.scipost.can_manage_college_composition %}
  <h3 class="highlight">Admin actions</h3>
  <div class="row">
    <div class="col-md-6">
      <ul>
	<li><a href="{% url 'colleges:potential_fellowship_update' pk=potfel.id %}">Update</a> the data</li>
	<li><a href="{% url 'colleges:potential_fellowship_delete' pk=potfel.id %}">Delete</a> this Potential Fellowship</li>
	<li><a href="{% url 'colleges:potential_fellowship_email_initial' pk=potfel.id %}">Prepare and send initial email</a></li>
      </ul>

    </div>
    <div class="col-md-6">
      <h3>Update the status of this Potential Fellowship</h3>
      <form class="d-block mt-2 mb-3" action="{% url 'colleges:potential_fellowship_update_status' pk=potfel.id %}" method="post">
	{% csrf_token %}
	{{ pfstatus_form|bootstrap }}
	<input type="submit" name="submit" value="Update status" class="btn btn-outline-secondary">
      </form>
    </div>
  </div>
  {% endif %}

  {% if perms.scipost.can_manage_college_composition %}
  <div class="row">
    <div class="col-12">
      <h3 class="highlight">Voting results</h3>
      <p>
	Voting Fellows' matching expertises are marked in <span class="bg-success">green</span>.
      </p>
    </div>
  </div>
  <div class="row">
    <div class="col-4">
      <table class="table">
	<tr><th>Agreed</th></tr>
	{% for fellow in potfel.in_agreement.all %}
	<tr>
	  <td>{{ fellow }}</td>
	  <td>{% for expertise in fellow.profile.expertises %}
            <div class="single d-inline{% if expertise in potfel.profile.expertises %} bg-success{% endif %}" data-specialization="{{expertise|lower}}" data-toggle="tooltip" data-placement="bottom" title="{{expertise|get_specialization_display}}">{{expertise|get_specialization_code}}</div>
	    {% endfor %}
	  </td>
	</tr>
	{% empty %}
	<tr><td>No Fellow has agreed</td></tr>
	{% endfor %}
      </table>
    </div>
    <div class="col-4">
      <table class="table">
	<tr><th>Abstained</th></tr>
	{% for fellow in potfel.in_abstain.all %}
	<tr>
	  <td>{{ fellow }}</td>
	  <td>{% for expertise in fellow.profile.expertises %}
            <div class="single d-inline{% if expertise in potfel.profile.expertises %} bg-success{% endif %}" data-specialization="{{expertise|lower}}" data-toggle="tooltip" data-placement="bottom" title="{{expertise|get_specialization_display}}">{{expertise|get_specialization_code}}</div>
	    {% endfor %}
	  </td>
	</tr>
	{% empty %}
	<tr><td>No Fellow has abstained</td></tr>
	{% endfor %}
      </table>
    </div>
    <div class="col-4">
      <table class="table">
	<tr><th>Disagreed</th></tr>
	{% for fellow in potfel.in_disagreement.all %}
	<tr>
	  <td>{{ fellow }}</td>
	  <td>{% for expertise in fellow.profile.expertises %}
            <div class="single d-inline{% if expertise in potfel.profile.expertises %} bg-success{% endif %}" data-specialization="{{expertise|lower}}" data-toggle="tooltip" data-placement="bottom" title="{{expertise|get_specialization_display}}">{{expertise|get_specialization_code}}</div>
	    {% endfor %}
	  </td>
	</tr>
	{% empty %}
	<tr><td>No Fellow has disagreed</td></tr>
	{% endfor %}
      </table>
    </div>
  </div>
  {% endif %}

  {% if perms.scipost.can_manage_college_composition %}
  <h3 class="highlight">Events</h3>
  <div class="row">
    <div class="col-md-6">
      <ul>
	{% for event in potfel.potentialfellowshipevent_set.all %}
	{% include 'colleges/_potentialfellowship_event_li.html' with event=event %}
	{% empty %}
	<li>No events found.</li>
	{% endfor %}
      </ul>
    </div>

    <div class="col-md-6">
      <h3>Add an event for this Potential Fellowship</h3>
      <form class="d-block mt-2 mb-3" action="{% url 'colleges:potential_fellowship_event_create' pk=potfel.id %}" method="post">
	{% csrf_token %}
	{{ pfevent_form|bootstrap }}
	<input type="submit" name="submit" value="Submit" class="btn btn-outline-secondary">
      </form>
    </div>
  </div>
  {% endif %}
</div>
